<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë˜ì „ ë¸Œë ˆì´ì»¤</title>
<style>
:root {
  --bg:#0a0a12; --panel:#12121e; --border:#2a2a3e;
  --gold:#c9a84c; --gold2:#f0d080;
  --red:#e05050; --blue:#4a9eff; --green:#50c878; --purple:#9b59b6;
  --crimson:#8b0000; --blood:#cc2244; --vampur:#6a0dad;
  --text:#e8e4d8; --muted:#7a7690;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
  background:var(--bg);
  color:var(--text);
  font-family:'Segoe UI',sans-serif;
  min-height:100vh;
  padding:14px;
  overflow-x:hidden;
}
#app{width:100%;max-width:460px;margin:0 auto;}

.screen{display:none;}
.screen.active{display:block;}

.btn{
  border:none; border-radius:8px;
  padding:10px 16px; font-size:13px; font-weight:700;
  cursor:pointer; transition:all .12s; font-family:inherit;
}
.btn:active{transform:scale(.95);}
.btn:disabled{opacity:.35;cursor:not-allowed;transform:none;}
.btn-gold{background:linear-gradient(135deg,#b8860b,#ffd700);color:#111;}
.btn-gold:hover:not(:disabled){filter:brightness(1.1);}
.btn-red{background:#c0392b;color:#fff;}
.btn-blue{background:#1a6ebd;color:#fff;}
.btn-green{background:#1a7a3a;color:#fff;}
.btn-gray{background:#1e1e2e;color:var(--muted);border:1px solid var(--border);}
.btn-gray:hover:not(:disabled){border-color:var(--gold);color:var(--text);}
.btn-blood{background:linear-gradient(135deg,var(--crimson),var(--blood));color:#fff;}
.btn-blood:hover:not(:disabled){filter:brightness(1.15);}

.bar-wrap{display:flex;align-items:center;gap:8px;margin-bottom:5px;}
.bar-label{font-size:11px;color:var(--muted);width:24px;}
.bar-track{flex:1;height:7px;background:#1a1a28;border-radius:4px;overflow:hidden;}
.bar-fill{height:100%;border-radius:4px;transition:width .3s;}
.bar-hp .bar-fill{background:linear-gradient(90deg,#8b1a1a,var(--red));}
.bar-hp.vampire-bar .bar-fill{background:linear-gradient(90deg,var(--crimson),var(--blood));}
.bar-mp .bar-fill{background:linear-gradient(90deg,#1a3a8b,var(--blue));}
.bar-mp.vampire-bar .bar-fill{background:linear-gradient(90deg,#3a0a4a,var(--vampur));}
.bar-exp .bar-fill{background:linear-gradient(90deg,#5a2080,var(--purple));}
.bar-val{font-size:11px;color:var(--muted);width:58px;text-align:right;}

#screen-title{text-align:center;padding-top:24px;}
.logo{
  font-size:40px;font-weight:900;letter-spacing:2px;
  background:linear-gradient(135deg,#b8860b,#ffd700,#b8860b);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:4px;
}
.logo-sub{font-size:11px;color:var(--muted);letter-spacing:4px;text-transform:uppercase;margin-bottom:36px;}
.class-row{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:20px;}
.cls-card{
  background:var(--panel);border:2px solid var(--border);
  border-radius:12px;padding:14px 8px;text-align:center;cursor:pointer;transition:.2s;
}
.cls-card:hover{border-color:var(--gold);}
.cls-card.sel{border-color:var(--gold);background:#1c1808;box-shadow:0 0 16px #c9a84c33;}
.cls-card.vampire-card.sel{border-color:var(--blood);background:#1a0510;box-shadow:0 0 16px #cc224455;}
.cls-card.vampire-card:hover{border-color:var(--blood);}
.cls-icon{font-size:30px;}
.cls-name{font-size:12px;font-weight:700;color:var(--gold);margin:6px 0 3px;}
.cls-card.vampire-card .cls-name{color:var(--blood);}
.cls-desc{font-size:10px;color:var(--muted);line-height:1.5;}

.battle-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.stage-badge{
  background:#1c1808;border:1px solid #b8860b;
  border-radius:6px;padding:4px 12px;
  font-size:12px;font-weight:700;color:var(--gold);letter-spacing:1px;
}
.turn-badge{
  font-size:11px;padding:4px 10px;border-radius:6px;font-weight:700;
  background:#0a1a2e;border:1px solid var(--blue);color:var(--blue);
}
.turn-badge.enemy-turn{background:#2e0a0a;border-color:var(--red);color:var(--red);}

.enemy-zone{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-bottom:10px;min-height:100px;align-items:flex-end;}
.enemy-card{
  background:#160a0a;border:2px solid #3a1a1a;
  border-radius:10px;padding:8px 10px;
  text-align:center;cursor:pointer;transition:.15s;
  flex:1;min-width:70px;max-width:110px;position:relative;
}
.enemy-card:hover:not(.dead){border-color:var(--gold);}
.enemy-card.targeted{border-color:var(--red);box-shadow:0 0 12px #e0505055;}
.enemy-card.dead{opacity:.25;pointer-events:none;filter:grayscale(1);}
.e-icon{font-size:26px;}
.e-name{font-size:10px;color:var(--muted);margin:3px 0 2px;}
.e-hpbar{width:100%;height:3px;background:#2a0a0a;border-radius:2px;overflow:hidden;}
.e-hpfill{height:100%;background:var(--red);border-radius:2px;transition:width .3s;}
.e-hp{font-size:10px;color:var(--red);margin-top:2px;}
.e-status{font-size:9px;color:var(--purple);}

.player-card{
  background:#0a0d18;border:1px solid #1e2a3a;
  border-radius:10px;padding:12px 14px;margin-bottom:10px;
  transition:border-color .3s;
}
.player-card.vampire-theme{background:#0d0608;border-color:#2a1020;}
.player-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.player-left{display:flex;align-items:center;gap:10px;}
.p-avatar{font-size:30px;}
.p-name{font-weight:700;font-size:14px;}
.p-lv{font-size:11px;color:var(--muted);}
.p-stats-right{font-size:11px;color:var(--muted);text-align:right;line-height:2;}
.stat-val{color:var(--gold);font-weight:700;}
.stat-val.blood-val{color:var(--blood);}

.blood-bar-wrap{display:flex;align-items:center;gap:8px;margin-bottom:5px;}
.blood-bar-track{
  flex:1;height:9px;background:#1a0808;border-radius:4px;overflow:hidden;
  border:1px solid #3a1020;
}
.blood-bar-fill{
  height:100%;border-radius:4px;
  background:linear-gradient(90deg,#4a0010,#cc2244,#ff6688);
  transition:width .4s;
  box-shadow:0 0 6px #cc224488;
}
.blood-val{font-size:11px;color:var(--blood);width:58px;text-align:right;font-weight:700;}
.blood-label{font-size:11px;color:var(--blood);width:24px;font-weight:700;}

.skills-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:8px;}
.skill-btn{
  background:#0e0e1a;border:1px solid var(--border);
  border-radius:9px;padding:9px 10px;
  cursor:pointer;text-align:left;transition:.15s;
  display:flex;align-items:center;gap:8px;
  font-family:inherit;color:var(--text);
}
.skill-btn:hover:not(:disabled){border-color:var(--gold);background:#161620;}
.skill-btn.vampire-skill:hover:not(:disabled){border-color:var(--blood);background:#1a0810;}
.skill-btn.mk-skill:hover:not(:disabled){border-color:#8ecae6;background:#08121a;}
.skill-btn.mk-skill-active{border-color:#4a9eff;box-shadow:0 0 8px #4a9eff44;}
.cls-card.mk-card:hover{border-color:#4a9eff;}
.cls-card.mk-card.sel{border-color:#4a9eff;background:#080e18;box-shadow:0 0 16px #4a9eff33;}
.cls-card.mk-card .cls-name{color:#4a9eff;}
.player-card.mk-theme{background:#060c14;border-color:#1a2a3a;}
.cls-card.mosquito-card:hover{border-color:#88cc44;}
.cls-card.mosquito-card.sel{border-color:#88cc44;background:#0a120a;box-shadow:0 0 16px #88cc4433;}
.cls-card.mosquito-card .cls-name{color:#88cc44;}
.player-card.mosquito-theme{background:#060d04;border-color:#1a2a10;}
.skill-btn:disabled{opacity:.38;cursor:not-allowed;}
.sk-icon{font-size:20px;flex-shrink:0;}
.sk-info{flex:1;min-width:0;}
.sk-name{font-size:12px;font-weight:700;}
.sk-meta{font-size:10px;color:var(--muted);}
.sk-cd{font-size:10px;color:var(--red);}
.sk-preview{font-size:10px;color:var(--blue);}
.sk-preview.blood-preview{color:var(--blood);}
.sk-preview.bomb-preview{color:#ff8c00;}
.sk-preview.sniper-preview{color:#7ec8a0;}

.action-row{display:flex;gap:6px;margin-bottom:8px;}
.action-row .btn{flex:1;padding:9px 6px;font-size:12px;line-height:1.4;}

.log-box{
  background:#080810;border:1px solid var(--border);
  border-radius:8px;padding:8px 10px;
  height:90px;overflow-y:auto;font-size:11px;line-height:1.8;
}
.log-box::-webkit-scrollbar{width:3px;}
.log-box::-webkit-scrollbar-thumb{background:var(--border);}
.log-p{color:var(--blue);}
.log-e{color:var(--red);}
.log-s{color:var(--gold);font-weight:700;}
.log-h{color:var(--green);}
.log-x{color:var(--purple);}
.log-v{color:var(--blood);font-weight:700;}

@keyframes floatHeal{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-28px)}}
.float-heal{
  position:fixed;
  font-size:13px;font-weight:700;pointer-events:none;
  color:#ff6688;
  animation:floatHeal 1s ease forwards;z-index:30;white-space:nowrap;
  text-shadow:0 0 8px #cc224488;
}

#screen-shop{padding-top:8px;}
.shop-header{
  display:flex;justify-content:space-between;align-items:center;
  background:#1c1808;border:1px solid #b8860b;
  border-radius:10px;padding:12px 16px;margin-bottom:10px;
}
.shop-title{font-size:20px;font-weight:900;color:var(--gold);}
.shop-gold{font-size:15px;font-weight:700;color:var(--gold);}
.shop-player-bar{
  background:var(--panel);border:1px solid var(--border);
  border-radius:10px;padding:10px 14px;margin-bottom:10px;
  font-size:11px;color:var(--muted);line-height:2;
}
.shop-sec{font-size:10px;font-weight:700;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin:10px 0 6px;}
.shop-grid{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:10px;}
.shop-item{
  background:#0e0e1a;border:1px solid var(--border);
  border-radius:10px;padding:10px;transition:.15s;
}
.shop-item.is-equipped{border-color:var(--green);background:#091409;}
.shop-item.no-gold{opacity:.45;}
.si-head{display:flex;align-items:center;gap:8px;margin-bottom:5px;}
.si-icon{font-size:22px;}
.si-name{font-size:12px;font-weight:700;line-height:1.3;}
.si-slot{font-size:10px;color:var(--muted);}
.si-stat{font-size:11px;color:var(--blue);margin-bottom:6px;}
.si-foot{display:flex;justify-content:space-between;align-items:center;gap:4px;}
.si-price{font-size:12px;color:var(--gold);font-weight:700;}
.potion-row{display:flex;gap:8px;margin-bottom:10px;}
.pot-card{
  flex:1;background:#0e0e1a;border:1px solid var(--border);
  border-radius:10px;padding:10px;text-align:center;
}
.pot-icon{font-size:24px;margin-bottom:4px;}
.pot-name{font-size:12px;font-weight:700;margin-bottom:2px;}
.pot-eff{font-size:10px;color:var(--muted);margin-bottom:4px;}
.pot-cnt{font-size:11px;color:var(--muted);margin-bottom:6px;}

.overlay{position:fixed;inset:0;background:#000b;display:none;align-items:center;justify-content:center;z-index:100;}
.overlay-box{
  background:linear-gradient(135deg,#14082a,#080e20);
  border:2px solid var(--purple);border-radius:16px;
  padding:28px 32px;text-align:center;
  box-shadow:0 0 40px #9b59b644;max-width:290px;width:90%;
}
@keyframes popIn{0%{transform:scale(.6);opacity:0}70%{transform:scale(1.06)}100%{transform:scale(1);opacity:1}}
.overlay-box{animation:popIn .35s ease forwards;}

#screen-result{text-align:center;padding-top:20px;}
.result-big{font-size:38px;font-weight:900;margin-bottom:6px;}
.result-win{color:var(--gold);}
.result-lose{color:var(--red);}
.result-card{background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px;margin:14px 0;text-align:left;}
.r-row{display:flex;justify-content:space-between;padding:4px 0;font-size:13px;}
.r-val{color:var(--gold);font-weight:700;}

@keyframes floatUp{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-32px)}}
.float-dmg{
  position:absolute;top:2px;left:50%;transform:translateX(-50%);
  font-size:15px;font-weight:700;pointer-events:none;
  animation:floatUp .85s ease forwards;z-index:20;white-space:nowrap;
}
@keyframes shakeX{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.do-shake{animation:shakeX .25s ease;}

@keyframes endingGlow{0%,100%{text-shadow:0 0 20px #c9a84c88}50%{text-shadow:0 0 40px #ffd700cc,0 0 80px #c9a84c55}}
#ending-title{animation:endingGlow 2s ease infinite;}

@keyframes bloodPulse{0%,100%{box-shadow:0 0 0 #cc224400}50%{box-shadow:0 0 14px #cc224466}}
.blood-ready{animation:bloodPulse 1.2s ease infinite;}

.skill-btn.blood-skill-available{
  border-color:#cc2244;
  box-shadow:0 0 8px #cc224444;
}

.hardmode-banner{
  background:linear-gradient(135deg,#1a0a00,#2a1400);
  border:2px solid #ff6600;border-radius:10px;
  padding:10px 14px;margin-bottom:10px;
  display:flex;align-items:center;gap:10px;
  box-shadow:0 0 16px #ff660033;
}
.hm-icon{font-size:24px;flex-shrink:0;}
.hm-text{flex:1;}
.hm-title{font-size:13px;font-weight:700;color:#ff8800;margin-bottom:2px;}
.hm-desc{font-size:11px;color:#a06030;}
.hm-badge{
  display:inline-block;background:#ff6600;color:#111;
  border-radius:4px;padding:2px 8px;font-size:10px;font-weight:700;
}
@keyframes hardGlow{0%,100%{box-shadow:0 0 16px #ff660033}50%{box-shadow:0 0 28px #ff660066,0 0 50px #ff440022}}
.hardmode-active .hardmode-banner{animation:hardGlow 2s ease infinite;}

.mode-select{display:flex;gap:8px;margin-bottom:14px;}
.mode-card{
  flex:1;border-radius:10px;padding:10px 12px;text-align:center;
  cursor:pointer;transition:.2s;border:2px solid var(--border);background:var(--panel);
}
.mode-card.sel-infinite{border-color:#50c878;background:#091409;box-shadow:0 0 12px #50c87833;}
.mode-card.sel-infinite .mode-name{color:#50c878;}
.mode-card:hover:not(.locked){border-color:var(--gold);}
.mode-card#mode-infinite:hover{border-color:#50c878;}
.mode-card.sel-normal{border-color:var(--gold);background:#1c1808;box-shadow:0 0 12px #c9a84c33;}
.mode-card.sel-hard{border-color:#ff6600;background:#1a0a00;box-shadow:0 0 12px #ff660033;}
.mode-card.locked{opacity:.35;cursor:not-allowed;}
.mode-icon{font-size:22px;margin-bottom:4px;}
.mode-name{font-size:12px;font-weight:700;color:var(--gold);}
.mode-card.sel-hard .mode-name,.mode-card.locked .mode-name{color:#ff8800;}
.mode-desc{font-size:10px;color:var(--muted);margin-top:3px;line-height:1.5;}

#screen-tutorial{padding-top:8px;}
.tut-title{font-size:20px;font-weight:900;color:var(--gold);margin-bottom:14px;}
.tut-tabs{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap;}
.tut-tab{
  padding:6px 12px;border-radius:20px;font-size:11px;font-weight:700;
  border:1px solid var(--border);background:var(--panel);color:var(--muted);
  cursor:pointer;transition:.15s;
}
.tut-tab:hover{border-color:var(--gold);color:var(--text);}
.tut-tab.active{background:#1c1808;border-color:var(--gold);color:var(--gold);}
.tut-page{display:none;}
.tut-page.active{display:block;}
.tut-section{
  background:var(--panel);border:1px solid var(--border);
  border-radius:10px;padding:12px 14px;margin-bottom:8px;
}
.tut-section-title{
  font-size:12px;font-weight:700;color:var(--gold);
  margin-bottom:8px;display:flex;align-items:center;gap:6px;
}
.tut-row{
  display:flex;align-items:flex-start;gap:10px;
  padding:6px 0;border-bottom:1px solid #1a1a2a;font-size:12px;line-height:1.6;
}
.tut-row:last-child{border-bottom:none;padding-bottom:0;}
.tut-icon{font-size:18px;flex-shrink:0;width:24px;text-align:center;margin-top:1px;}
.tut-text{flex:1;color:var(--muted);}
.tut-text strong{color:var(--text);}
.tut-text .hl{color:var(--gold);font-weight:700;}
.tut-text .hl-red{color:var(--red);font-weight:700;}
.tut-text .hl-blue{color:var(--blue);font-weight:700;}
.tut-text .hl-green{color:var(--green);font-weight:700;}
.tut-text .hl-blood{color:var(--blood);font-weight:700;}
.tut-tip{
  background:#0a0d18;border:1px solid #1a3a6a;border-radius:8px;
  padding:9px 12px;margin-top:8px;font-size:11px;color:#6a9ecc;line-height:1.7;
}
.tut-tip::before{content:'ğŸ’¡ ';}
.class-compare{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:6px;}
.cc-card{background:#0a0a14;border:1px solid var(--border);border-radius:8px;padding:8px 10px;}
.cc-name{font-size:12px;font-weight:700;margin-bottom:4px;}
.cc-stat{font-size:10px;color:var(--muted);line-height:1.9;}

.record-overlay{
  position:fixed;inset:0;background:#000b;
  display:none;align-items:center;justify-content:center;z-index:200;
}
.record-box{
  background:linear-gradient(135deg,#0e0e1e,#12121e);
  border:2px solid var(--gold);border-radius:16px;
  padding:24px 28px;max-width:280px;width:90%;
  box-shadow:0 0 40px #c9a84c33;
  animation:popIn .25s ease forwards;
}
.record-box.vampire-rec{border-color:var(--blood);box-shadow:0 0 40px #cc224433;}
.record-box.mk-rec{border-color:#4a9eff;box-shadow:0 0 40px #4a9eff33;}
.record-box.mosquito-rec{border-color:#88cc44;box-shadow:0 0 40px #88cc4433;}
.record-box.bomb-rec{border-color:#ff6600;box-shadow:0 0 40px #ff660033;}
.record-box.god-rec{border-color:#ffd700;box-shadow:0 0 40px #ffd70055;}
.rec-header{display:flex;align-items:center;gap:10px;margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid var(--border);}
.rec-avatar{font-size:32px;}
.rec-title{font-size:16px;font-weight:900;color:var(--gold);}
.rec-subtitle{font-size:11px;color:var(--muted);}
.rec-row{display:flex;justify-content:space-between;padding:6px 0;font-size:13px;border-bottom:1px solid #1a1a2a;}
.rec-row:last-of-type{border-bottom:none;}
.rec-label{color:var(--muted);}
.rec-val{color:var(--gold);font-weight:700;}
.rec-empty{text-align:center;color:var(--muted);font-size:12px;padding:16px 0;line-height:2;}
.rec-close{width:100%;margin-top:14px;}

.ach-screen{padding-top:8px;}
.ach-title{font-size:20px;font-weight:900;color:var(--gold);margin-bottom:4px;}
.ach-subtitle{font-size:11px;color:var(--muted);margin-bottom:14px;}
.ach-progress-bar{height:6px;background:#1a1a28;border-radius:3px;overflow:hidden;margin-bottom:14px;}
.ach-progress-fill{height:100%;background:linear-gradient(90deg,#5a2080,var(--purple));border-radius:3px;transition:width .4s;}
.ach-progress-label{font-size:11px;color:var(--muted);text-align:right;margin-top:3px;margin-bottom:10px;}
.ach-grid{display:flex;flex-direction:column;gap:7px;margin-bottom:14px;}
.ach-card{
  background:var(--panel);border:1px solid var(--border);
  border-radius:10px;padding:10px 14px;
  display:flex;align-items:center;gap:12px;transition:.2s;
}
.ach-card.unlocked{border-color:#5a3a00;background:#130e00;}
.ach-card.unlocked.rare{border-color:#1a2a5a;background:#08091a;}
.ach-card.unlocked.epic{border-color:#3a1a5a;background:#0e0818;}
.ach-card.unlocked.legendary{border-color:#5a4a00;background:#100d00;box-shadow:0 0 12px #c9a84c22;}
.ach-card.unlocked.meme{border-color:#2a4a1a;background:#0a1206;}
.ach-icon{font-size:28px;flex-shrink:0;width:36px;text-align:center;}
.ach-icon.locked{filter:grayscale(1);opacity:.3;}
.ach-info{flex:1;min-width:0;}
.ach-name{font-size:13px;font-weight:700;color:var(--text);}
.ach-card.unlocked .ach-name{color:var(--gold);}
.ach-card.unlocked.rare .ach-name{color:#6aabff;}
.ach-card.unlocked.epic .ach-name{color:#c060ff;}
.ach-card.unlocked.legendary .ach-name{color:#ffd700;}
.ach-card.unlocked.meme .ach-name{color:#a8e060;}
.ach-desc{font-size:11px;color:var(--muted);margin-top:2px;}
.ach-badge{font-size:10px;padding:2px 7px;border-radius:10px;font-weight:700;flex-shrink:0;}
.ach-badge.common{background:#2a2a1a;color:#a08020;}
.ach-badge.rare{background:#1a2040;color:#4a80ff;}
.ach-badge.epic{background:#2a1040;color:#a040ff;}
.ach-badge.legendary{background:#3a2a00;color:#ffd700;}
.ach-badge.meme{background:#1a3010;color:#80cc40;}
.ach-badge.locked-badge{background:#1a1a2a;color:#444;}
.ach-date{font-size:10px;color:var(--muted);margin-top:2px;}

@keyframes slideUp{0%{transform:translateY(60px);opacity:0}15%{transform:translateY(0);opacity:1}85%{transform:translateY(0);opacity:1}100%{transform:translateY(60px);opacity:0}}
.ach-toast{
  position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
  background:linear-gradient(135deg,#1a1000,#2a1a00);
  border:2px solid var(--gold);border-radius:12px;
  padding:10px 18px;display:flex;align-items:center;gap:10px;
  z-index:500;pointer-events:none;white-space:nowrap;
  animation:slideUp 3s ease forwards;
  box-shadow:0 4px 20px #c9a84c44;
}
.ach-toast-icon{font-size:22px;}
.ach-toast-text{font-size:12px;}
.ach-toast-title{font-weight:900;color:var(--gold);}
.ach-toast-name{color:var(--text);}

.cheat-panel{
  background:#0a0810;border:2px solid #2a1a4a;
  border-radius:12px;padding:14px;margin-top:12px;
  font-family:'Courier New',monospace;
}
.cheat-header{
  display:flex;align-items:center;gap:8px;margin-bottom:10px;
  border-bottom:1px solid #2a1a4a;padding-bottom:8px;
}
.cheat-header-dots{display:flex;gap:5px;}
.cheat-dot{width:10px;height:10px;border-radius:50%;}
.cheat-title{font-size:11px;color:#6a5a9a;letter-spacing:2px;flex:1;text-align:center;}
.cheat-question{
  background:#06040e;border:1px solid #1a0a3a;border-radius:8px;
  padding:10px 12px;margin-bottom:8px;
}
.cheat-q-label{font-size:10px;color:#5a4a7a;margin-bottom:4px;letter-spacing:1px;}
.cheat-q-text{font-size:12px;color:#b090e0;font-weight:700;}
.cheat-input-row{display:flex;gap:6px;}
.cheat-input{
  flex:1;background:#08060f;border:1px solid #2a1a4a;border-radius:7px;
  padding:8px 12px;color:#d0b0ff;font-family:'Courier New',monospace;
  font-size:13px;outline:none;transition:.2s;
}
.cheat-input:focus{border-color:#7a4aff;box-shadow:0 0 8px #7a4aff33;}
.cheat-input::placeholder{color:#3a2a5a;}
.cheat-submit{
  background:linear-gradient(135deg,#3a1a8a,#7a4aff);color:#fff;
  border:none;border-radius:7px;padding:8px 14px;font-size:12px;
  font-weight:700;cursor:pointer;font-family:inherit;transition:.15s;
  white-space:nowrap;
}
.cheat-submit:hover{filter:brightness(1.2);}
.cheat-result{
  margin-top:8px;font-size:11px;padding:7px 10px;
  border-radius:6px;display:none;line-height:1.6;
}
.cheat-result.ok{background:#0a1a08;border:1px solid #2a6a1a;color:#70e040;}
.cheat-result.fail{background:#1a0808;border:1px solid #4a1a1a;color:#e04040;}
.cheat-result.hint{background:#0a0820;border:1px solid #2a1a6a;color:#8060d0;}

.cls-card.necro-card:hover{border-color:#50e0a0;}
.cls-card.necro-card.sel{border-color:#50e0a0;background:#041210;box-shadow:0 0 16px #50e0a033;}
.cls-card.necro-card .cls-name{color:#50e0a0;}
.player-card.necro-theme{background:#040e0a;border-color:#0a2a1a;}

/* â•â• ì¢€ë¹„ ì¡´ (ìˆ˜ì •ë¨) â•â• */
.zombie-zone{
  display:flex;gap:4px;flex-wrap:wrap;justify-content:flex-start;
  margin-bottom:6px;min-height:0;align-items:flex-end;
}
/* ì‚´ì•„ìˆëŠ” ì¢€ë¹„ */
.zombie-card{
  background:#061a0e;border:2px solid #1a4a2a;
  border-radius:8px;padding:6px 8px;text-align:center;
  flex:0 0 auto;width:68px;position:relative;transition:.15s;
}
/* ì£½ì€ ì¢€ë¹„ â€” ë¬˜ë¹„ í˜•íƒœë¡œ ì‘ê²Œ */
.zombie-card.zombie-dead{
  width:28px;height:28px;
  padding:2px;
  background:#0a0a0a;
  border:1px solid #2a2a2a;
  border-radius:6px;
  opacity:.55;
  overflow:hidden;
  display:flex;align-items:center;justify-content:center;
  cursor:default;
}
.zombie-card.zombie-dead .z-gravestone{
  font-size:16px;line-height:1;
  display:block;
}
/* ì£½ì€ ì¢€ë¹„ì—ì„œ ìˆ¨ê¸¸ ìš”ì†Œë“¤ */
.zombie-card.zombie-dead .z-icon,
.zombie-card.zombie-dead .z-name,
.zombie-card.zombie-dead .z-hpbar,
.zombie-card.zombie-dead .z-hp{
  display:none;
}
.z-icon{font-size:20px;}
.z-name{font-size:9px;color:#50e0a0;margin:2px 0 1px;font-weight:700;}
.z-hpbar{width:100%;height:3px;background:#0a1a0e;border-radius:2px;overflow:hidden;}
.z-hpfill{height:100%;background:#50e0a0;border-radius:2px;transition:width .3s;}
.z-hp{font-size:9px;color:#50e0a0;}
.zombie-shield-label{font-size:10px;color:#50e0a0;font-weight:700;margin-bottom:3px;letter-spacing:1px;}
@keyframes zombieShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-3px)}75%{transform:translateX(3px)}}
.zombie-hit{animation:zombieShake .2s ease;}

/* ì£½ì€ ì¢€ë¹„ ì§„ì… ì• ë‹ˆë©”ì´ì…˜ */
@keyframes graveDrop{0%{transform:scale(1.3);opacity:0}100%{transform:scale(1);opacity:.55}}
.zombie-card.zombie-dead{animation:graveDrop .3s ease forwards;}

/* ì¢€ë¹„ ìˆ˜ ìš”ì•½ ë±ƒì§€ */
.zombie-count-badge{
  display:inline-flex;align-items:center;gap:4px;
  background:#061a0e;border:1px solid #1a4a2a;
  border-radius:12px;padding:2px 8px;
  font-size:10px;color:#50e0a0;font-weight:700;
  margin-left:6px;
}

.cls-card.god-card:hover{border-color:#ffd700;}
.cls-card.god-card.sel{
  border-color:#ffd700;background:#100a00;
  box-shadow:0 0 20px #ffd70055;
}
.cls-card.god-card .cls-name{
  background:linear-gradient(135deg,#ffd700,#ff9900,#ffd700);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
@keyframes godPulse{0%,100%{box-shadow:0 0 20px #ffd70033}50%{box-shadow:0 0 40px #ffd70077,0 0 80px #ff990033}}
.cls-card.god-card.sel{animation:godPulse 2s ease infinite;}
.player-card.god-theme{
  background:#100a00;border-color:#5a4a00;
  box-shadow:0 0 20px #ffd70022;
}

/* â•â• ì €ê²©ìˆ˜ í…Œë§ˆ â•â• */
.cls-card.sniper-card:hover{border-color:#7ec8a0;}
.cls-card.sniper-card.sel{
  border-color:#7ec8a0;background:#041410;
  box-shadow:0 0 16px #7ec8a044;
}
.cls-card.sniper-card .cls-name{color:#7ec8a0;}
.player-card.sniper-theme{background:#040e0a;border-color:#0e2a1a;}

/* í—¤ë“œìƒ· ê²Œì´ì§€ */
.scope-bar-wrap{display:flex;align-items:center;gap:8px;margin-bottom:5px;}
.scope-bar-track{
  flex:1;height:9px;background:#080e0a;border-radius:4px;overflow:hidden;
  border:1px solid #1a3a24;
}
.scope-bar-fill{
  height:100%;border-radius:4px;
  background:linear-gradient(90deg,#0d3320,#3a9960,#7ec8a0);
  transition:width .4s;
}
.scope-val{font-size:11px;color:#7ec8a0;width:58px;text-align:right;font-weight:700;}
.scope-label{font-size:11px;color:#7ec8a0;width:24px;font-weight:700;}

/* ì¡°ì¤€ ì¶©ì „ ì‹œ ê¸€ë¡œìš° */
@keyframes scopePulse{0%,100%{box-shadow:0 0 0 #7ec8a000}50%{box-shadow:0 0 16px #7ec8a055}}
.scope-ready{animation:scopePulse 1s ease infinite;}

/* í—¤ë“œìƒ· ë°œë™ ì‹œ í”Œë¡œíŒ… */
@keyframes headshotBlast{0%{opacity:1;transform:translateY(0) scale(1)}30%{transform:translateY(-8px) scale(1.5)}100%{opacity:0;transform:translateY(-34px) scale(.7)}}
.float-headshot{
  position:absolute;top:-4px;left:50%;transform:translateX(-50%);
  font-size:14px;font-weight:900;pointer-events:none;
  color:#ff4466;text-shadow:0 0 10px #ff446688,0 0 20px #ff446644;
  animation:headshotBlast 1.0s ease forwards;z-index:25;white-space:nowrap;
  letter-spacing:1px;
}

/* ìœ„ì¥ ìƒíƒœ í‘œì‹œ */
.camo-active{
  border-color:#7ec8a0 !important;
  box-shadow:0 0 10px #7ec8a055 !important;
}
@keyframes camoFlicker{0%,100%{opacity:1}50%{opacity:.6}}
.camo-active .p-avatar{animation:camoFlicker 2s ease infinite;}

/* ì €ê²©ìˆ˜ ìŠ¤í‚¬ ë²„íŠ¼ */
.skill-btn.sniper-skill:hover:not(:disabled){border-color:#7ec8a0;background:#060e08;}
.skill-btn.sniper-skill-ready{border-color:#7ec8a0;box-shadow:0 0 8px #7ec8a044;}

/* â•â• í­íƒ„ë³‘ í…Œë§ˆ â•â• */
.cls-card.bomb-card:hover{border-color:#ff6600;}
.cls-card.bomb-card.sel{
  border-color:#ff6600;background:#140800;
  box-shadow:0 0 16px #ff660044;
}
.cls-card.bomb-card .cls-name{color:#ff8c00;}
.player-card.bomb-theme{background:#0e0600;border-color:#3a1800;}
/* í­íƒ„ í­ë°œ ê²Œì´ì§€ */
.fuse-bar-wrap{display:flex;align-items:center;gap:8px;margin-bottom:5px;}
.fuse-bar-track{
  flex:1;height:9px;background:#1a0800;border-radius:4px;overflow:hidden;
  border:1px solid #3a1800;
}
.fuse-bar-fill{
  height:100%;border-radius:4px;
  background:linear-gradient(90deg,#331100,#ff6600,#ffcc00);
  transition:width .4s;
}
.fuse-val{font-size:11px;color:#ff8c00;width:58px;text-align:right;font-weight:700;}
.fuse-label{font-size:11px;color:#ff8c00;width:24px;font-weight:700;}
/* ë„í™”ì„  ì¶©ì „ ì‹œ í­íƒ„ ê¸€ë¡œìš° */
@keyframes fusePulse{0%,100%{box-shadow:0 0 0 #ff660000}50%{box-shadow:0 0 16px #ff660066}}
.fuse-ready{animation:fusePulse 1s ease infinite;}
/* ê¸°ë³¸ ê³µê²© ì „ì²´ ê³µê²© í‘œì‹œ */
.all-attack-badge{
  display:inline-block;background:#331100;border:1px solid #ff6600;
  border-radius:4px;padding:1px 5px;font-size:9px;color:#ff8c00;font-weight:700;
  margin-left:4px;
}
/* í­íƒ„ë³‘ ìŠ¤í‚¬ ë²„íŠ¼ ê°•ì¡° */
.skill-btn.bomb-skill:hover:not(:disabled){border-color:#ff6600;background:#180a00;}
.skill-btn.bomb-skill-ready{border-color:#ff6600;box-shadow:0 0 8px #ff660044;}
/* í­ë°œ í”Œë¡œíŒ… í…ìŠ¤íŠ¸ */
@keyframes bombBlast{0%{opacity:1;transform:translateY(0) scale(1)}50%{transform:translateY(-10px) scale(1.3)}100%{opacity:0;transform:translateY(-28px) scale(.8)}}
.float-bomb{
  position:absolute;top:2px;left:50%;transform:translateX(-50%);
  font-size:16px;font-weight:900;pointer-events:none;
  color:#ff8c00;text-shadow:0 0 8px #ff660088;
  animation:bombBlast .9s ease forwards;z-index:20;white-space:nowrap;
}
</style>
</head>
<body>
<div id="app">

<div class="record-overlay" id="record-overlay" onclick="closeRecord()">
  <div class="record-box" id="record-box" onclick="event.stopPropagation()">
    <div class="rec-header">
      <div class="rec-avatar" id="rec-avatar"></div>
      <div>
        <div class="rec-title" id="rec-title"></div>
        <div class="rec-subtitle">ì „ì  ê¸°ë¡</div>
      </div>
    </div>
    <div id="rec-body"></div>
    <button class="btn btn-gray rec-close" onclick="closeRecord()">ë‹«ê¸°</button>
  </div>
</div>

<div class="overlay" id="lu-overlay">
  <div class="overlay-box">
    <div style="font-size:36px">â¬†ï¸</div>
    <div style="font-size:20px;font-weight:900;color:var(--purple);margin:4px 0">LEVEL UP!</div>
    <div style="font-size:44px;font-weight:900;color:var(--gold)" id="lu-lv">2</div>
    <div style="font-size:13px;color:var(--muted);margin:10px 0 18px;line-height:2" id="lu-stats"></div>
    <button class="btn btn-gold" style="width:100%" onclick="closeLu()">ê³„ì†!</button>
  </div>
</div>

<div class="screen active" id="screen-title">
  <div class="logo">DUNGEON<br>BREAKER</div>
  <div class="logo-sub">Turn Based RPG</div>
  <p style="font-size:12px;color:var(--muted);margin-bottom:8px;">ì§ì—… ì„ íƒ</p>
  <div class="class-row" id="class-row"></div>
  <p style="font-size:12px;color:var(--muted);margin-bottom:8px;">ëª¨ë“œ ì„ íƒ</p>
  <div class="mode-select" id="mode-select">
    <div class="mode-card sel-normal" id="mode-normal" onclick="selectMode('normal')">
      <div class="mode-icon">âš”ï¸</div>
      <div class="mode-name">ì¼ë°˜ ëª¨ë“œ</div>
      <div class="mode-desc">ê¸°ë³¸ ë‚œì´ë„ë¡œ<br>ë„ì „!</div>
    </div>
    <div class="mode-card locked" id="mode-hard" onclick="selectMode('hard')">
      <div class="mode-icon">ğŸ”¥</div>
      <div class="mode-name">í•˜ë“œ ëª¨ë“œ</div>
      <div class="mode-desc" id="hard-desc">20ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ í›„<br>í•´ì œë©ë‹ˆë‹¤</div>
    </div>
    <div class="mode-card" id="mode-infinite" onclick="selectMode('infinite')">
      <div class="mode-icon">â™¾ï¸</div>
      <div class="mode-name" style="color:#50c878;">ë¬´í•œ ëª¨ë“œ</div>
      <div class="mode-desc">ëì—†ëŠ” ë˜ì „!<br>ìµœê³  ìŠ¤í…Œì´ì§€ ë„ì „</div>
    </div>
  </div>
  <div style="display:flex;gap:8px;">
    <button class="btn btn-gold" style="flex:1;padding:14px;font-size:15px" onclick="startGame()">ëª¨í—˜ ì‹œì‘!</button>
    <button class="btn btn-gray" style="padding:14px 16px;font-size:13px" onclick="showScreen('tutorial')">ğŸ“– ë„ì›€ë§</button>
    <button class="btn btn-gray" style="padding:14px 16px;font-size:13px" onclick="showAchievements()">ğŸ… ì—…ì </button>
  </div>

  <div class="cheat-panel" style="margin-top:12px;">
    <div class="cheat-header">
      <div class="cheat-header-dots">
        <div class="cheat-dot" style="background:#ff5f57"></div>
        <div class="cheat-dot" style="background:#febc2e"></div>
        <div class="cheat-dot" style="background:#28c840"></div>
      </div>
      <div class="cheat-title">ğŸ’» CHEAT TERMINAL v1.0</div>
    </div>
    <div class="cheat-input-row">
      <input class="cheat-input" id="cheat-input" placeholder="ì½”ë“œ ì…ë ¥..." onkeydown="if(event.key==='Enter')submitCheat()"/>
      <button class="cheat-submit" onclick="submitCheat()">â–¶ ì‹¤í–‰</button>
    </div>
    <div class="cheat-result" id="cheat-result"></div>
  </div>
</div>

<div class="screen" id="screen-achievements">
  <div class="ach-screen">
    <div class="ach-title">ğŸ… ë„ì „ê³¼ì œ</div>
    <div class="ach-subtitle" id="ach-subtitle">ë‹¬ì„±: 0 / 0</div>
    <div class="ach-progress-bar"><div class="ach-progress-fill" id="ach-progress-fill" style="width:0%"></div></div>
    <div class="ach-grid" id="ach-grid"></div>
    <button class="btn btn-gray" style="width:100%;padding:13px;font-size:13px" onclick="showScreen('title')">â† íƒ€ì´í‹€ë¡œ ëŒì•„ê°€ê¸°</button>
  </div>
</div>

<div class="screen" id="screen-tutorial">
  <div class="tut-title">ğŸ“– ê²Œì„ ê°€ì´ë“œ</div>
  <div class="tut-tabs">
    <div class="tut-tab active" onclick="switchTutTab(0)">ê¸°ë³¸ ì „íˆ¬</div>
    <div class="tut-tab" onclick="switchTutTab(1)">ìŠ¤íƒ¯ & ì„±ì¥</div>
    <div class="tut-tab" onclick="switchTutTab(2)">ì§ì—… ì†Œê°œ</div>
    <div class="tut-tab" onclick="switchTutTab(3)">ğŸ§› ë±€íŒŒì´ì–´</div>
    <div class="tut-tab" onclick="switchTutTab(4)">ğŸ’€ ë„¤í¬ë¡œ</div>
    <div class="tut-tab" onclick="switchTutTab(5)">ğŸ›¡ï¸ ë©”ê°€ë‚˜ì´íŠ¸</div>
    <div class="tut-tab" onclick="switchTutTab(6)">ğŸ¦Ÿ ëª¨ê¸°</div>
    <div class="tut-tab" onclick="switchTutTab(7)">ğŸ’£ í­íƒ„ë³‘</div>
    <div class="tut-tab" onclick="switchTutTab(8)">ğŸ¯ ì €ê²©ìˆ˜</div>
  </div>
  <div class="tut-page active" id="tut-0">
    <div class="tut-section">
      <div class="tut-section-title">âš” ì „íˆ¬ íë¦„</div>
      <div class="tut-row"><div class="tut-icon">1ï¸âƒ£</div><div class="tut-text">ì  ì¹´ë“œë¥¼ <strong>í´ë¦­</strong>í•´ ê³µê²© ëŒ€ìƒì„ ì§€ì •í•©ë‹ˆë‹¤. ë¹¨ê°„ í…Œë‘ë¦¬ê°€ í˜„ì¬ íƒ€ê²Ÿì…ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">2ï¸âƒ£</div><div class="tut-text">í–‰ë™ì„ ì„ íƒí•˜ë©´ <span class="hl">ë‚´ í„´</span>ì´ ëë‚˜ê³  ì ì´ ì°¨ë¡€ëŒ€ë¡œ ê³µê²©í•©ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">3ï¸âƒ£</div><div class="tut-text">ëª¨ë“  ì ì„ ì²˜ì¹˜í•˜ë©´ ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´! <span class="hl">ìƒì </span>ì—ì„œ ì¥ë¹„ì™€ í¬ì…˜ì„ êµ¬ë§¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">4ï¸âƒ£</div><div class="tut-text">HPê°€ 0ì´ ë˜ë©´ <span class="hl-red">ê²Œì„ ì˜¤ë²„</span>. ì´ <span class="hl">20 ìŠ¤í…Œì´ì§€</span>ë¥¼ í´ë¦¬ì–´í•˜ë©´ ì—”ë”©ì…ë‹ˆë‹¤.</div></div>
      <div class="tut-tip">HPì™€ MPëŠ” ìŠ¤í…Œì´ì§€ê°€ ë„˜ì–´ê°€ë„ ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤. ìƒì ì—ì„œ í¬ì…˜ì„ ì˜ í™œìš©í•˜ì„¸ìš”!</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ® í–‰ë™ ì„ íƒì§€</div>
      <div class="tut-row"><div class="tut-icon">âš”</div><div class="tut-text"><strong>ê¸°ë³¸ ê³µê²©</strong> â€” ATKÃ—0.8 ë°ë¯¸ì§€. MPë¥¼ ì†ŒëŸ‰ íšŒë³µí•©ë‹ˆë‹¤. ì–¸ì œë‚˜ ì‚¬ìš© ê°€ëŠ¥.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ›¡</div><div class="tut-text"><strong>ë°©ì–´</strong> â€” ë‹¤ìŒ ì  í„´ê¹Œì§€ DEF +8. ê°•ì  ì•ì—ì„œ íš¨ê³¼ì ì…ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ§ª</div><div class="tut-text"><strong>HP í¬ì…˜</strong> â€” ìµœëŒ€ HPì˜ 40% ì¦‰ì‹œ íšŒë³µ. ìƒì ì—ì„œ 20Gì— êµ¬ë§¤ ê°€ëŠ¥.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’§</div><div class="tut-text"><strong>MP í¬ì…˜</strong> â€” ìµœëŒ€ MPì˜ 50% ì¦‰ì‹œ íšŒë³µ. ìƒì ì—ì„œ 15Gì— êµ¬ë§¤ ê°€ëŠ¥.</div></div>
      <div class="tut-row"><div class="tut-icon">âœ¨</div><div class="tut-text"><strong>ìŠ¤í‚¬</strong> â€” MPë¥¼ ì†Œëª¨í•´ ê°•ë ¥í•œ íš¨ê³¼ ë°œë™. ì‚¬ìš© í›„ ì¿¨ë‹¤ìš´ì´ ìƒê¹ë‹ˆë‹¤.</div></div>
      <div class="tut-tip">ìŠ¤í‚¬ ë²„íŠ¼ì— í‘œì‹œë˜ëŠ” <span style="color:var(--blue)">"ì˜ˆìƒ DMG"</span>ëŠ” í˜„ì¬ íƒ€ê²Ÿ ê¸°ì¤€ ì¶”ì •ì¹˜ì…ë‹ˆë‹¤.</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ‘¿ ë³´ìŠ¤ ìŠ¤í…Œì´ì§€</div>
      <div class="tut-row"><div class="tut-icon">âš </div><div class="tut-text">5, 10, 15, 20 ìŠ¤í…Œì´ì§€ëŠ” <span class="hl-red">BOSS</span> ìŠ¤í…Œì´ì§€ì…ë‹ˆë‹¤. ê°•ë ¥í•œ ì ì´ ì¡°í•©ìœ¼ë¡œ ë“±ì¥í•©ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ“ˆ</div><div class="tut-text">ìŠ¤í…Œì´ì§€ê°€ ë†’ì•„ì§ˆìˆ˜ë¡ ëª¨ë“  ì ì˜ HPÂ·ATKÂ·DEFê°€ <span class="hl">ìŠ¤ì¼€ì¼ ìƒìŠ¹</span>í•©ë‹ˆë‹¤.</div></div>
    </div>
  </div>
  <div class="tut-page" id="tut-1">
    <div class="tut-section">
      <div class="tut-section-title">ğŸ“Š ê¸°ë³¸ ìŠ¤íƒ¯</div>
      <div class="tut-row"><div class="tut-icon">â¤</div><div class="tut-text"><strong>HP</strong> â€” 0ì´ ë˜ë©´ ê²Œì„ ì˜¤ë²„. í¬ì…˜ì´ë‚˜ í¡í˜ˆë¡œ íšŒë³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’œ</div><div class="tut-text"><strong>MP</strong> â€” ìŠ¤í‚¬ ì‚¬ìš©ì— ì†Œëª¨ë©ë‹ˆë‹¤. ê¸°ë³¸ ê³µê²© ì‹œ ì†ŒëŸ‰ íšŒë³µ.</div></div>
      <div class="tut-row"><div class="tut-icon">âš”</div><div class="tut-text"><strong>ATK</strong> â€” ê³µê²©ë ¥. ì¥ë¹„Â·ë²„í”„ë¡œ ì¦ê°€. ìŠ¤í‚¬ ë°ë¯¸ì§€ ê³„ì‚°ì˜ ê¸°ì¤€ì…ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ›¡</div><div class="tut-text"><strong>DEF</strong> â€” ë°©ì–´ë ¥. ì ì˜ ê³µê²© ë°ë¯¸ì§€ë¥¼ ì¤„ì…ë‹ˆë‹¤. (ì‹¤ì œ ê°ì†Œ = DEF-2)</div></div>
      <div class="tut-tip">ë°ë¯¸ì§€ ê³µì‹: <span class="hl">ATK Ã— ë°°ìœ¨ âˆ’ max(0, DEFâˆ’2) + ëœë¤(-3~+4)</span><br>ë°©ì–´ë ¥ì´ ë†’ì„ìˆ˜ë¡ ìœ ë¦¬í•˜ì§€ë§Œ ì™„ë²½íˆ ë§‰ì„ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">â­ ë ˆë²¨ì—…</div>
      <div class="tut-row"><div class="tut-icon">ğŸ”º</div><div class="tut-text">ì ì„ ì²˜ì¹˜í•˜ë©´ <span class="hl">ê²½í—˜ì¹˜(EXP)</span>ë¥¼ íšë“í•©ë‹ˆë‹¤. EXP ë°”ê°€ ê°€ë“ ì°¨ë©´ ë ˆë²¨ì—…!</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’ª</div><div class="tut-text">ë ˆë²¨ì—… ì‹œ <strong>HPÂ·MPÂ·ATKÂ·DEF</strong>ê°€ ì§ì—…ë³„ ì„±ì¥ì¹˜ë§Œí¼ ì˜¤ë¦…ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ“ˆ</div><div class="tut-text">ë ˆë²¨ì—…ì— í•„ìš”í•œ EXPëŠ” ë§¤ë²ˆ <span class="hl">1.4ë°°</span>ì”© ì¦ê°€í•©ë‹ˆë‹¤.</div></div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ›’ ì¥ë¹„ ì‹œìŠ¤í…œ</div>
      <div class="tut-row"><div class="tut-icon">ğŸ—¡ï¸</div><div class="tut-text"><strong>ë¬´ê¸°</strong> â€” ATK ì¦ê°€. ë‚¡ì€ ê²€ â†’ ê°•ì²  ê²€ â†’ ë§ˆë²• ê²€ ìˆœìœ¼ë¡œ ê°•ë ¥í•©ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ›¡</div><div class="tut-text"><strong>ë°©ì–´êµ¬</strong> â€” DEF ì¦ê°€. ê°€ì£½ ê°‘ì˜· â†’ ì‚¬ìŠ¬ ê°‘ì˜· â†’ íŒê¸ˆ ê°‘ì˜·.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’</div><div class="tut-text"><strong>ë°˜ì§€Â·ëª©ê±¸ì´</strong> â€” ATKì™€ DEFë¥¼ ë™ì‹œì— ì˜¬ë ¤ì£¼ëŠ” ë³´ì¡° ì¥ë¹„.</div></div>
      <div class="tut-tip">í•œ ë²ˆ êµ¬ë§¤í•œ ì¥ë¹„ëŠ” ì˜êµ¬ ë³´ìœ í•©ë‹ˆë‹¤. ê°™ì€ ìŠ¬ë¡¯ ì¥ë¹„ë¥¼ ìƒˆë¡œ ì‚¬ë©´ ìë™ êµì²´ë©ë‹ˆë‹¤.</div>
    </div>
  </div>
  <div class="tut-page" id="tut-2">
    <div class="tut-section">
      <div class="tut-section-title">âš”ï¸ ì „ì‚¬ â€” ê· í˜•ì¡íŒ íƒ±ì»¤</div>
      <div class="tut-row"><div class="tut-icon">ğŸ“‹</div><div class="tut-text">HP 150 Â· ATK 20 Â· DEF 10 Â· MP 40<br>ë†’ì€ HPì™€ DEFë¡œ ì˜¤ë˜ ë²„í‹°ëŠ” íƒ€ì….</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸŒŸ</div><div class="tut-text"><strong>ê°•íƒ€</strong> Â· <strong>ë°©íŒ¨ëŒì§„</strong> Â· <strong>íšŒì˜¤ë¦¬</strong>(ì „ì²´) Â· <strong>ì „íˆ¬í•¨ì„±</strong>(ATK ë²„í”„)</div></div>
      <div class="tut-tip">ë°©ì–´ + ì „íˆ¬í•¨ì„± ì½¤ë³´ë¡œ ATKë¥¼ ìŒ“ì€ ë’¤ ê°•íƒ€ë¡œ í­ë”œí•˜ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ”® ë§ˆë²•ì‚¬ â€” ê³ í™”ë ¥ ë”œëŸ¬</div>
      <div class="tut-row"><div class="tut-icon">ğŸ“‹</div><div class="tut-text">HP 90 Â· ATK 10 Â· DEF 3 Â· MP 120<br>ë‚®ì€ ì²´ë ¥ì´ì§€ë§Œ ì••ë„ì ì¸ ìŠ¤í‚¬ ë°ë¯¸ì§€.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸŒŸ</div><div class="tut-text"><strong>íŒŒì´ì–´ë³¼</strong>(ATKÃ—3.5) Â· <strong>ë¸”ë¦¬ìë“œ</strong>(ì „ì²´) Â· <strong>ë²ˆê°œ</strong>(ATKÃ—5.0) Â· <strong>ë§ˆë‚˜í¡ìˆ˜</strong>(MP íšŒë³µ)</div></div>
      <div class="tut-tip">HPê°€ ë‚®ì•„ ë§ìœ¼ë©´ ìœ„í—˜í•©ë‹ˆë‹¤. í¬ì…˜ì„ ë„‰ë„‰íˆ í™•ë³´í•˜ê³  ë§ˆë‚˜í¡ìˆ˜ë¡œ MPë¥¼ ìˆœí™˜ì‹œí‚¤ì„¸ìš”.</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ—¡ï¸ ë„ì  â€” ê³ ì† ì•”ì‚´ì</div>
      <div class="tut-row"><div class="tut-icon">ğŸ“‹</div><div class="tut-text">HP 100 Â· ATK 18 Â· DEF 5 Â· MP 70<br>ë¹ ë¥¸ ì¿¨ë‹¤ìš´ê³¼ ë…Â·íšŒí”¼ íŠ¹ìˆ˜ ê¸°ìˆ .</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸŒŸ</div><div class="tut-text"><strong>ì´ì¤‘ì°Œë¥´ê¸°</strong>(2íƒ€) Â· <strong>ë…ë‹¨ê²€</strong>(ì§€ì† í”¼í•´) Â· <strong>ì—°ë§‰íƒ„</strong>(50% íšŒí”¼) Â· <strong>ì•”ì‚´</strong>(ATKÃ—6.0)</div></div>
      <div class="tut-tip">ì´ì¤‘ì°Œë¥´ê¸°ëŠ” ì¿¨ë‹¤ìš´ì´ 1í„´ìœ¼ë¡œ ë§¤ìš° ì§§ìŠµë‹ˆë‹¤. ë…ì„ ê±¸ê³  ì—°ë§‰íƒ„ìœ¼ë¡œ í”¼í•´ë¥¼ ì¤„ì´ëŠ” ê²ƒì´ í•µì‹¬.</div>
    </div>
  </div>
  <div class="tut-page" id="tut-3">
    <div class="tut-section">
      <div class="tut-section-title">ğŸ§› ë±€íŒŒì´ì–´ â€” í¡í˜ˆ íŠ¹ìˆ˜ ì§ì—…</div>
      <div class="tut-row"><div class="tut-icon">ğŸ“‹</div><div class="tut-text">HP 110 Â· ATK 19 Â· DEF 6 Â· MP 80<br>ê³µê²©ê³¼ í”¼ê²©ìœ¼ë¡œ <span class="hl-blood">í˜ˆê¸°</span>ë¥¼ ì¶©ì „í•˜ëŠ” ë…íŠ¹í•œ ì§ì—….</div></div>
      <div class="tut-row"><div class="tut-icon">âš </div><div class="tut-text">ì¼ë°˜ ì§ì—… ì¤‘ê°„ ìˆ˜ì¤€ì˜ ìŠ¤íƒ¯ì´ì§€ë§Œ, í¡í˜ˆë¡œ <strong>ìê°€ íšŒë³µ</strong>ì´ ê°€ëŠ¥í•´ ì§€ì†ì „ì— ê°•í•©ë‹ˆë‹¤.</div></div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ©¸ í˜ˆê¸°(Blood) ì‹œìŠ¤í…œ</div>
      <div class="tut-row"><div class="tut-icon">ğŸ©¸</div><div class="tut-text"><strong>í˜ˆê¸° ê²Œì´ì§€</strong>ëŠ” ë±€íŒŒì´ì–´ ì „ìš© 3ë²ˆì§¸ ìì›ì…ë‹ˆë‹¤. ìµœëŒ€ 100 (ë ˆë²¨ì—… ì‹œ +10).</div></div>
      <div class="tut-row"><div class="tut-icon">âš”</div><div class="tut-text"><span class="hl-blood">ê¸°ë³¸ ê³µê²©</span> ì‹œ í”¼í•´ëŸ‰ì˜ <span class="hl">10%</span> í˜ˆê¸° ì¶©ì „.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ©¹</div><div class="tut-text"><span class="hl-blood">í”¼ê²©</span> ì‹œ ë°›ì€ í”¼í•´ì˜ <span class="hl">30%</span> í˜ˆê¸° ì¶©ì „. ë§ì„ìˆ˜ë¡ ê°•í•´ì§‘ë‹ˆë‹¤!</div></div>
      <div class="tut-row"><div class="tut-icon">âœ¨</div><div class="tut-text">í˜ˆê¸° ìŠ¤í‚¬ ì‚¬ìš© ì‹œ ì†Œëª¨í•©ë‹ˆë‹¤. ê²Œì´ì§€ê°€ <span class="hl">50 ì´ìƒ</span>ì´ë©´ ë¶‰ì€ ê¸€ë¡œìš°ê°€ í™œì„±í™”ë©ë‹ˆë‹¤.</div></div>
      <div class="tut-tip">í˜ˆê¸°ëŠ” ê³µê²©ë³´ë‹¤ <strong>í”¼ê²© ì‹œ ë” ë¹ ë¥´ê²Œ</strong> ì¶©ì „ë©ë‹ˆë‹¤. ìœ„ê¸° ìƒí™©ì— í˜ˆê¸°ê°€ ìŒ“ì´ë©´ ë¶ˆì‚¬ì˜ í”¼ë¡œ ì—­ì „ì„ ë…¸ë¦¬ì„¸ìš”!</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸŒŸ ë±€íŒŒì´ì–´ ìŠ¤í‚¬</div>
      <div class="tut-row"><div class="tut-icon">ğŸ©¸</div><div class="tut-text"><strong>í¡í˜ˆ</strong> (MP 12 Â· ì¿¨2) â€” ATKÃ—2.0 ë‹¨ì¼ ê³µê²©. í”¼í•´ì˜ <span class="hl-blood">40%</span>ë¥¼ HPë¡œ í¡ìˆ˜.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ¦‡</div><div class="tut-text"><strong>ë°•ì¥ êµ°ë‹¨</strong> (MP 24 Â· ì¿¨4) â€” ATKÃ—1.2 ì „ì²´ ê³µê²©. ê° ì ì—ê²Œ ì…íŒ í”¼í•´ì˜ <span class="hl-blood">30%</span> í¡ìˆ˜.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’¥</div><div class="tut-text"><strong>í˜ˆê¸° í­ë°œ</strong> (MP 20 Â· ì¿¨4 Â· <span class="hl-blood">í˜ˆê¸° 50</span>) â€” í˜ˆê¸°ë¥¼ ì†Œëª¨í•´ ì „ì²´ì— ATKÃ—1.4 ê°•ë ¥ ê³µê²©.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸŒ‘</div><div class="tut-text"><strong>ë¶ˆì‚¬ì˜ í”¼</strong> (ì¿¨8 Â· <span class="hl-blood">í˜ˆê¸° 70</span>) â€” í˜ˆê¸°ë¥¼ ì†Œëª¨í•´ ìµœëŒ€ HPì˜ <span class="hl-green">60%</span>ë¥¼ ì¦‰ì‹œ íšŒë³µ!</div></div>
      <div class="tut-tip">ë¶ˆì‚¬ì˜ í”¼ëŠ” MP ì†Œëª¨ê°€ ì—†ëŠ” ëŒ€ì‹  í˜ˆê¸° 70ì´ í•„ìš”í•©ë‹ˆë‹¤. ì¿¨íƒ€ì„ë„ ê¸¸ê¸° ë•Œë¬¸ì— íƒ€ì´ë°ì„ ì˜ ê³¨ë¼ì•¼ í•©ë‹ˆë‹¤.</div>
    </div>
  </div>
  <div class="tut-page" id="tut-4">
    <div class="tut-section">
      <div class="tut-section-title">ğŸ’€ ë„¤í¬ë¡œë§¨ì„œ â€” ì¢€ë¹„ êµ°ë‹¨ ì§€íœ˜ê´€</div>
      <div class="tut-row"><div class="tut-icon">ğŸ“‹</div><div class="tut-text">HP 95 Â· ATK 14 Â· DEF 4 Â· MP 100<br>ìŠ¤ìŠ¤ë¡œëŠ” ì•½í•˜ì§€ë§Œ ì¢€ë¹„ë¥¼ ì†Œí™˜í•´ ë°©íŒ¨ ì‚¼ê³  ê°™ì´ ì‹¸ìš°ëŠ” ì „ëµí˜• ì§ì—….</div></div>
      <div class="tut-row"><div class="tut-icon">âš </div><div class="tut-text">í˜¼ìì„œëŠ” ë²„í‹°ê¸° ì–´ë µìŠµë‹ˆë‹¤. ìµœëŒ€í•œ ë¹¨ë¦¬ ì¢€ë¹„ë¥¼ ì†Œí™˜í•´ <strong>ë°©íŒ¨ë¥¼ ì„¸ìš°ëŠ” ê²ƒ</strong>ì´ í•µì‹¬ì…ë‹ˆë‹¤.</div></div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ§Ÿ ì¢€ë¹„ ì‹œìŠ¤í…œ</div>
      <div class="tut-row"><div class="tut-icon">ğŸ›¡</div><div class="tut-text"><strong>ë°©íŒ¨ ì—­í• </strong> â€” ì‚´ì•„ìˆëŠ” ì¢€ë¹„ê°€ ìˆìœ¼ë©´ ì ì˜ ê³µê²©ì„ <span class="hl-green">ëŒ€ì‹  ë§ìŠµë‹ˆë‹¤.</span></div></div>
      <div class="tut-row"><div class="tut-icon">âš”</div><div class="tut-text"><strong>ê³µê²© ì—­í• </strong> â€” ì¢€ë¹„ë“¤ì€ ë§¤ í„´ ì‚´ì•„ìˆëŠ” ì ì„ ëœë¤ìœ¼ë¡œ ê³µê²©í•©ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">â™¾ï¸</div><div class="tut-text"><strong>ìŠ¤í…Œì´ì§€ ì§€ì†</strong> â€” ì¢€ë¹„ëŠ” ìŠ¤í…Œì´ì§€ê°€ ë„˜ì–´ê°€ë„ <span class="hl">ì£½ì§€ ì•Šê³  ìœ ì§€</span>ë©ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸª¦</div><div class="tut-text"><strong>ì£½ì€ ì¢€ë¹„</strong> â€” ì“°ëŸ¬ì§„ ì¢€ë¹„ëŠ” ì‘ì€ <span class="hl">ë¬˜ë¹„(ğŸª¦)</span>ë¡œ í‘œì‹œë©ë‹ˆë‹¤. ì‹œì²´ í­ë°œì— ì¹´ìš´íŠ¸ë©ë‹ˆë‹¤!</div></div>
      <div class="tut-tip">ì¢€ë¹„ëŠ” ìŒ“ì¼ìˆ˜ë¡ ê°•ë ¥í•´ì§‘ë‹ˆë‹¤. 3~4ë§ˆë¦¬ê°€ ëª¨ì´ë©´ ì  ê³µê²©ì„ í•œë™ì•ˆ ë²„í…¨ì¤ë‹ˆë‹¤!</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸŒŸ ë„¤í¬ë¡œë§¨ì„œ ìŠ¤í‚¬</div>
      <div class="tut-row"><div class="tut-icon">ğŸ§Ÿ</div><div class="tut-text"><strong>ì¢€ë¹„ ì†Œí™˜</strong> (MP 18 Â· ì¿¨3) â€” ì¢€ë¹„ë¥¼ ì†Œí™˜í•©ë‹ˆë‹¤. HPëŠ” ë ˆë²¨ì— ë¹„ë¡€. ë°©íŒ¨ + ê³µê²© ì—­í• .</div></div>
      <div class="tut-row"><div class="tut-icon">â˜ ï¸</div><div class="tut-text"><strong>ì €ì£¼ ì†ê°€ë½</strong> (MP 14 Â· ì¿¨2) â€” ATKÃ—2.0 ë‹¨ì¼ ê³µê²© + <span class="hl-red">ë…(3í„´)</span> ë¶€ì—¬.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’¥</div><div class="tut-text"><strong>ì‹œì²´ í­ë°œ</strong> (MP 22 Â· ì¿¨4) â€” ì‚´ì•„ìˆëŠ” ì¢€ë¹„ 1ê¸°ë¥¼ í¬ìƒí•´ ê°•ë ¥í•œ ë‹¨ì¼ ê³µê²©.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’€</div><div class="tut-text"><strong>ì–¸ë°ë“œ êµ°ë‹¨</strong> (MP 30 Â· ì¿¨5) â€” ATKÃ—1.1 ì „ì²´ ê³µê²©.</div></div>
      <div class="tut-tip">ì‹œì²´ í­ë°œì€ ì¢€ë¹„ê°€ ì—†ìœ¼ë©´ ì‚¬ìš© ë¶ˆê°€! ì“°ëŸ¬ì§„ ë¬˜ë¹„ë“¤ì´ ë§ì„ìˆ˜ë¡ ìœ„ë ¥ë„ ì˜¬ë¼ê°‘ë‹ˆë‹¤.</div>
    </div>
  </div>
  <div class="tut-page" id="tut-5">
    <div class="tut-section">
      <div class="tut-section-title">ğŸ›¡ï¸ ë©”ê°€ ë‚˜ì´íŠ¸ â€” ì² ë²½ íƒ±ì»¤</div>
      <div class="tut-row"><div class="tut-icon">ğŸ“‹</div><div class="tut-text">HP 280 Â· ATK 8 Â· DEF 12 Â· MP ì—†ìŒ<br>ì••ë„ì ì¸ HPì™€ DEFë¡œ ë²„í‹°ëŠ” ê¶ê·¹ì˜ íƒ±ì»¤.</div></div>
      <div class="tut-row"><div class="tut-icon">âš </div><div class="tut-text">ATKê°€ ë‚®ì•„ ë”œì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ìŠ¤í‚¬ì„ ì ê·¹ í™œìš©í•˜ê³  ì¥ë¹„ë¡œ ATKë¥¼ ë³´ì™„í•˜ì„¸ìš”.</div></div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ›¡ MP ì—†ìŒ ì‹œìŠ¤í…œ</div>
      <div class="tut-row"><div class="tut-icon">âœ¨</div><div class="tut-text">ëª¨ë“  ìŠ¤í‚¬ì˜ <strong>MP ì†Œëª¨ê°€ 0</strong>ì…ë‹ˆë‹¤. ì¿¨ë‹¤ìš´ë§Œ ê¸°ë‹¤ë¦¬ë©´ ì œí•œ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’§</div><div class="tut-text">MP í¬ì…˜ì€ ì‚¬ìš© ë¶ˆê°€ì…ë‹ˆë‹¤. HP í¬ì…˜ íš¨ìœ¨ì´ ì¼ë°˜ë³´ë‹¤ ë‚®ìŠµë‹ˆë‹¤ <span class="hl-red">(íšŒë³µëŸ‰ 20%)</span>.</div></div>
      <div class="tut-tip">HPê°€ 280ìœ¼ë¡œ ë§¤ìš° ë†’ì§€ë§Œ í¬ì…˜ íš¨ìœ¨ì´ ë‚®ìŠµë‹ˆë‹¤. ì² ê°‘ ë°©ì–´ë¡œ DEFë¥¼ ìŒ“ì•„ í”¼í•´ë¥¼ ìµœì†Œí™”í•˜ì„¸ìš”.</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸŒŸ ë©”ê°€ ë‚˜ì´íŠ¸ ìŠ¤í‚¬</div>
      <div class="tut-row"><div class="tut-icon">ğŸª¨</div><div class="tut-text"><strong>ì² ë²½ ê°•íƒ€</strong> (ì¿¨2 Â· MPë¬´ì†Œëª¨) â€” ATKÃ—1.8 ë‹¨ì¼ ê³µê²©.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸŒ</div><div class="tut-text"><strong>ëŒ€ì§€ ì§„ë™</strong> (ì¿¨3 Â· MPë¬´ì†Œëª¨) â€” ATKÃ—0.7 ì „ì²´ ê³µê²©.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ°</div><div class="tut-text"><strong>ì² ê°‘ ë°©ì–´</strong> (ì¿¨3 Â· MPë¬´ì†Œëª¨) â€” DEF +15 (3í„´).</div></div>
      <div class="tut-row"><div class="tut-icon">âš¡</div><div class="tut-text"><strong>ë§¹ê³µê²©</strong> (ì¿¨4 Â· MPë¬´ì†Œëª¨) â€” ATKÃ—1.0 Ã—3íƒ€.</div></div>
      <div class="tut-tip">ì² ê°‘ ë°©ì–´ â†’ ë§¹ê³µê²© ì½¤ë³´ê°€ í•µì‹¬ì…ë‹ˆë‹¤.</div>
    </div>
  </div>
  <div class="tut-page" id="tut-6">
    <div class="tut-section">
      <div class="tut-section-title">ğŸ¦Ÿ ëª¨ê¸° â€” ê·¹ë‹¨ì˜ ë„ë°•ì‚¬</div>
      <div class="tut-row"><div class="tut-icon">ğŸ“‹</div><div class="tut-text">HP <span class="hl-red">1</span> Â· ATK 45 Â· DEF 0 Â· MP 50<br>ë‹¨ í•˜ë‚˜ë¿ì¸ ëª©ìˆ¨. í•˜ì§€ë§Œ ë§¤ í„´ <span class="hl-green">99% í™•ë¥ ë¡œ íšŒí”¼</span>í•©ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">âš </div><div class="tut-text">HPê°€ 1ì´ë¼ ë‹¨ í•œ ë²ˆì´ë¼ë„ ë§ìœ¼ë©´ ì¦‰ì‚¬ì…ë‹ˆë‹¤.</div></div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ’¨ 99% íšŒí”¼ ì‹œìŠ¤í…œ</div>
      <div class="tut-row"><div class="tut-icon">ğŸ²</div><div class="tut-text">ì ì˜ ê³µê²©ë§ˆë‹¤ <strong>99% í™•ë¥ ë¡œ ìë™ íšŒí”¼</strong>í•©ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’€</div><div class="tut-text">ë ˆë²¨ì—…ì„ í•´ë„ <span class="hl-red">HPëŠ” ì˜ì›íˆ 1</span>ì…ë‹ˆë‹¤.</div></div>
      <div class="tut-tip">ì ì´ 3ë§ˆë¦¬ë¼ë©´ í•œ í„´ì— íšŒí”¼ë¥¼ 3ë²ˆ êµ´ë¦½ë‹ˆë‹¤. 1% Ã— 3ë²ˆ = ì•½ 3% í™•ë¥ ë¡œ ë§ìŠµë‹ˆë‹¤. ğŸ°</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸŒŸ ëª¨ê¸° ìŠ¤í‚¬</div>
      <div class="tut-row"><div class="tut-icon">ğŸ©¸</div><div class="tut-text"><strong>í¡í˜ˆ ì°Œë¥´ê¸°</strong> (MP 10 Â· ì¿¨1) â€” ATKÃ—2.5.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’¨</div><div class="tut-text"><strong>ê¸‰ìŠµ</strong> (MP 14 Â· ì¿¨2) â€” ATKÃ—4.0 ê°•íƒ€.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ¦Ÿ</div><div class="tut-text"><strong>êµ°ì§‘</strong> (MP 18 Â· ì¿¨3) â€” ATKÃ—1.5 ì „ì²´ ê³µê²©.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ“¡</div><div class="tut-text"><strong>ì´ˆìŒíŒŒ</strong> (MP 22 Â· ì¿¨4) â€” ATKÃ—6.5 ë‹¨ì¼ ê³µê²©.</div></div>
      <div class="tut-tip">ATK 45 ê¸°ì¤€ ì´ˆìŒíŒŒ í•œ ë°©ì´ ì•½ 290 ë°ë¯¸ì§€! ìš´ë§Œ ë”°ë¼ì¤€ë‹¤ë©´ ì–´ë–¤ ì§ì—…ë³´ë‹¤ ê°•ë ¥í•©ë‹ˆë‹¤ ğŸ˜ˆ</div>
    </div>
  </div>
  <div class="tut-page" id="tut-7">
    <div class="tut-section">
      <div class="tut-section-title">ğŸ’£ í­íƒ„ë³‘ â€” ì „ì²´ ê³µê²© ì „ë¬¸ê°€</div>
      <div class="tut-row"><div class="tut-icon">ğŸ“‹</div><div class="tut-text">HP <span class="hl-green">155</span> Â· ATK <span class="hl-green">20</span> Â· DEF 5 Â· MP 60<br><span class="hl">ê¸°ë³¸ ê³µê²©ì„ í¬í•¨í•œ ëª¨ë“  ê³µê²©ì´ ì „ì²´ ê³µê²©</span>ì…ë‹ˆë‹¤. ì ì´ ë§ì„ìˆ˜ë¡ ê°•í•´ì§‘ë‹ˆë‹¤!</div></div>
      <div class="tut-row"><div class="tut-icon">âš </div><div class="tut-text">ATKê°€ ë‚®ì€ í¸ì´ë¼ ë‹¨ì¼ ë”œì€ ì•½í•©ë‹ˆë‹¤. ë‹¤ìˆ˜ì˜ ì ì„ ìƒëŒ€í•  ë•Œ ì§„ê°€ë¥¼ ë°œíœ˜í•©ë‹ˆë‹¤.</div></div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ§¨ ë„í™”ì„ (Fuse) ì‹œìŠ¤í…œ</div>
      <div class="tut-row"><div class="tut-icon">ğŸ§¨</div><div class="tut-text"><strong>ë„í™”ì„  ê²Œì´ì§€</strong>ëŠ” í­íƒ„ë³‘ ì „ìš© 3ë²ˆì§¸ ìì›ì…ë‹ˆë‹¤. ìµœëŒ€ 100 (ë ˆë²¨ì—…ë§ˆë‹¤ +5).</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’£</div><div class="tut-text">ê³µê²© ìŠ¤í‚¬ì„ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ <span class="hl">ë„í™”ì„ ì´ ìë™ìœ¼ë¡œ ì¶©ì „</span>ë©ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ”¥</div><div class="tut-text">ë„í™”ì„ ì´ <span class="hl">70 ì´ìƒ</span>ì´ë©´ ì—°ì‡„ í­ë°œ ìŠ¤í‚¬ì´ í•´ê¸ˆë©ë‹ˆë‹¤. ê²Œì´ì§€ê°€ ë¹›ë‚˜ê¸° ì‹œì‘í•˜ë©´ í•„ì‚´ê¸° íƒ€ì´ë°!</div></div>
      <div class="tut-tip">ê¸°ë³¸ ê³µê²©ë„ ë„í™”ì„ ì„ ì¶©ì „í•©ë‹ˆë‹¤. ì „íˆ¬ ì´ˆë°˜ì—ëŠ” ê¸°ë³¸ ê³µê²©ê³¼ ìŠ¤í‚¬ì„ ë²ˆê°ˆì•„ ì¨ì„œ ë„í™”ì„ ì„ ë¹ ë¥´ê²Œ ìŒ“ìœ¼ì„¸ìš”.</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸŒŸ í­íƒ„ë³‘ ìŠ¤í‚¬ (ì „ë¶€ ì „ì²´ ê³µê²©!)</div>
      <div class="tut-row"><div class="tut-icon">ğŸ’£</div><div class="tut-text"><strong>ìˆ˜ë¥˜íƒ„</strong> (MP 10 Â· ì¿¨2) â€” ì „ì²´ ATKÃ—1.0 Â· <span class="hl">ë„í™”ì„  +20</span>. ë¹ ë¥¸ ë„í™”ì„  ì¶©ì „.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ‡</div><div class="tut-text"><strong>í´ëŸ¬ìŠ¤í„°</strong> (MP 16 Â· ì¿¨3) â€” ì „ì²´ ATKÃ—1.4 Â· <span class="hl">ë„í™”ì„  +30</span>. í•µì‹¬ ë”œ ìŠ¤í‚¬.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ’¨</div><div class="tut-text"><strong>ì—°ë§‰ í­íƒ„</strong> (MP 14 Â· ì¿¨3) â€” ì „ì²´ ATKÃ—0.7 + ìì‹  <span class="hl">DEF +12 (2í„´)</span>. ìƒì¡´ìš© ìŠ¤í‚¬.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ”¥</div><div class="tut-text"><strong>ì—°ì‡„ í­ë°œ</strong> (MP 22 Â· ì¿¨5 Â· <span class="hl">ë„í™”ì„  70</span>) â€” ë„í™”ì„  ì†Œëª¨! ì „ì²´ì— ATKÃ—2.2ë¥¼ <span class="hl">2ì—°ì†</span> í­ë°œ.</div></div>
      <div class="tut-tip">ì—°ì‡„ í­ë°œì€ ì  3ë§ˆë¦¬ ê¸°ì¤€ìœ¼ë¡œ ì´ 6íšŒ ê³µê²©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤. ë³´ìŠ¤ ìŠ¤í…Œì´ì§€ì—ì„œ ëª°ì•„ë„£ê³  í„°ëœ¨ë¦¬ë©´ ê·¹ê°•ì˜ í­ë”œ!</div>
    </div>
  </div>
  <div class="tut-page" id="tut-8">
    <div class="tut-section">
      <div class="tut-section-title">ğŸ¯ ì €ê²©ìˆ˜ â€” ì •ë°€ í—¤ë“œìƒ· ë”œëŸ¬</div>
      <div class="tut-row"><div class="tut-icon">ğŸ“‹</div><div class="tut-text">HP 105 Â· ATK 22 Â· DEF 4 Â· MP 65<br>ê°•ë ¥í•œ ë‹¨ì¼ ë”œê³¼ <span class="hl-green">30% í—¤ë“œìƒ·</span>, ê¸°ë³¸ <span class="hl">10% ìœ„ì¥ íšŒí”¼</span>ë¥¼ ê°–ì¶˜ ì •ë°€ ë”œëŸ¬.</div></div>
      <div class="tut-row"><div class="tut-icon">âš </div><div class="tut-text">HPì™€ DEFê°€ ë‚®ìŠµë‹ˆë‹¤. ìœ„ì¥ ìŠ¤í‚¬ê³¼ íšŒí”¼ë¥¼ í™œìš©í•´ í”¼í•´ë¥¼ ì¤„ì´ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.</div></div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸª– ê¸°ë³¸ ìœ„ì¥ ì‹œìŠ¤í…œ</div>
      <div class="tut-row"><div class="tut-icon">ğŸ²</div><div class="tut-text">ì•„ë¬´ëŸ° ë²„í”„ ì—†ì´ë„ <strong>ë§¤ ê³µê²©ë§ˆë‹¤ 10% í™•ë¥ ë¡œ ìë™ íšŒí”¼</strong>í•©ë‹ˆë‹¤.</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ¥¤</div><div class="tut-text">ìœ„ì¥ ê°•í™” ëŒ€ì‹  <strong>ì—ë„ˆì§€ë“œë§í¬(ì¿¨4)</strong>ë¡œ HPë¥¼ íšŒë³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœëŒ€ HPì˜ 30% ì¦‰ì‹œ íšŒë³µ!</div></div>
      <div class="tut-tip">ì €ê²©ìˆ˜ëŠ” íšŒí”¼ê°€ 10%ë¿ì´ë¼ ë§ìœ¼ë©´ ìœ„í—˜í•©ë‹ˆë‹¤. ì—ë„ˆì§€ë“œë§í¬ë¡œ ì²´ë ¥ì„ ê´€ë¦¬í•˜ê³  ìì£¼í¬ë¡œ ê°•ë ¥í•œ í•œ ë°©ì„ ë…¸ë¦¬ì„¸ìš”!</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸ¯ í—¤ë“œìƒ· ì‹œìŠ¤í…œ</div>
      <div class="tut-row"><div class="tut-icon">ğŸ”«</div><div class="tut-text"><strong>ì €ê²©ì´</strong> ì‚¬ìš© ì‹œ ë§¤ë²ˆ <span class="hl">30% í™•ë¥ </span>ë¡œ í—¤ë“œìƒ·ì´ ë°œë™í•´ ë°ë¯¸ì§€ê°€ <span class="hl">2ë°°</span>ê°€ ë©ë‹ˆë‹¤!</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ”¥</div><div class="tut-text"><strong>ìì£¼í¬ ì§€ì›</strong>ì€ ATKÃ—6.0ì˜ ê°•ë ¥í•œ ë‹¨ë°œ í¬ê²©ì…ë‹ˆë‹¤. í—¤ë“œìƒ·ê³¼ ë³„ê°œë¡œ <span class="hl-red">ë§¤ìš° ë†’ì€ ë°ë¯¸ì§€</span>ë¥¼ ëƒ…ë‹ˆë‹¤.</div></div>
      <div class="tut-tip">ATK 22 ê¸°ì¤€ ìì£¼í¬ ì§€ì› ì•½ 130+! ë³´ìŠ¤ ë“±ì¥ ì‹œ ìì£¼í¬ë¡œ ë¨¼ì € í° í”¼í•´ë¥¼ ì£¼ê³  ì €ê²©ì´ í—¤ë“œìƒ·ìœ¼ë¡œ ë§ˆë¬´ë¦¬í•˜ì„¸ìš”.</div>
    </div>
    <div class="tut-section">
      <div class="tut-section-title">ğŸŒŸ ì €ê²©ìˆ˜ ìŠ¤í‚¬</div>
      <div class="tut-row"><div class="tut-icon">ğŸ”«</div><div class="tut-text"><strong>ì €ê²©ì´</strong> (MP 14 Â· ì¿¨2) â€” ATKÃ—3.0 ê°•ë ¥ ë‹¨ì¼ ê³µê²©. <span class="hl">30% í—¤ë“œìƒ· â†’ ë°ë¯¸ì§€ 2ë°°!</span></div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ¥¤</div><div class="tut-text"><strong>ì—ë„ˆì§€ë“œë§í¬</strong> (MP 12 Â· ì¿¨4) â€” ìµœëŒ€ HPì˜ <span class="hl-green">30% ì¦‰ì‹œ íšŒë³µ</span>. ìœ„ê¸° íƒˆì¶œìš© ìŠ¤í‚¬!</div></div>
      <div class="tut-row"><div class="tut-icon">âœˆï¸</div><div class="tut-text"><strong>ê³µì¤‘ì§€ì›</strong> (MP 20 Â· ì¿¨4) â€” ì „ì²´ ATKÃ—1.6 ê³µìŠµ. ë‹¤ìˆ˜ì˜ ì ì„ í•œë²ˆì— ì²˜ë¦¬!</div></div>
      <div class="tut-row"><div class="tut-icon">ğŸ”¥</div><div class="tut-text"><strong>ìì£¼í¬ ì§€ì›</strong> (MP 28 Â· ì¿¨6) â€” ATKÃ—6.0 ê°•ë ¥ ë‹¨ì¼ í¬ê²©! ì¿¨íƒ€ì„ì´ ê¸¸ì–´ <span class="hl-red">íƒ€ì´ë°ì´ ì¤‘ìš”</span>í•©ë‹ˆë‹¤.</div></div>
      <div class="tut-tip">ìì£¼í¬ ì§€ì›(ì¿¨6)ì„ ë³´ìŠ¤ì „ì— ë§ì¶° ì•„ê»´ë‘ì„¸ìš”. ì²´ë ¥ì´ ìœ„í—˜í•˜ë©´ ì—ë„ˆì§€ë“œë§í¬(ì¿¨4)ë¡œ íšŒë³µ í›„ ì €ê²©ì´ìœ¼ë¡œ ë§ˆë¬´ë¦¬í•˜ì„¸ìš”!</div>
    </div>
    <button class="btn btn-gray" style="width:100%;padding:13px;font-size:13px;margin-top:4px" onclick="showScreen('title')">â† íƒ€ì´í‹€ë¡œ ëŒì•„ê°€ê¸°</button>
  </div>
</div>

<!-- ì „íˆ¬ -->
<div class="screen" id="screen-battle">
  <div class="battle-top">
    <div class="stage-badge" id="stage-badge">STAGE 1</div>
    <div id="turn-badge" class="turn-badge">ë‚´ í„´</div>
    <div style="font-size:12px;color:var(--muted)">Lv<span id="hud-lv">1</span></div>
  </div>

  <div class="enemy-zone" id="enemy-zone"></div>

  <div id="zombie-zone-wrap" style="display:none;">
    <div style="display:flex;align-items:center;margin-bottom:3px;">
      <div class="zombie-shield-label">ğŸ§Ÿ ì¢€ë¹„ ë°©íŒ¨</div>
      <div id="zombie-count-badge" class="zombie-count-badge"></div>
    </div>
    <div class="zombie-zone" id="zombie-zone"></div>
  </div>

  <div class="player-card" id="player-card">
    <div class="player-top">
      <div class="player-left">
        <div class="p-avatar" id="p-avatar">âš”ï¸</div>
        <div>
          <div class="p-name" id="p-name">ì „ì‚¬</div>
          <div class="p-lv">Lv <span id="p-lv">1</span></div>
        </div>
      </div>
      <div class="p-stats-right">
        ATK <span class="stat-val" id="p-atk">-</span>
        DEF <span class="stat-val" id="p-def">-</span>
      </div>
    </div>
    <div class="bar-wrap bar-hp" id="hp-bar-wrap">
      <div class="bar-label">HP</div>
      <div class="bar-track bar-hp" id="hp-track"><div class="bar-fill" id="bar-hp" style="width:100%"></div></div>
      <div class="bar-val"><span id="p-hp">-</span>/<span id="p-mhp">-</span></div>
    </div>
    <div class="bar-wrap bar-mp" id="mp-bar-wrap">
      <div class="bar-label" id="mp-label">MP</div>
      <div class="bar-track bar-mp" id="mp-track"><div class="bar-fill" id="bar-mp" style="width:100%"></div></div>
      <div class="bar-val"><span id="p-mp">-</span>/<span id="p-mmp">-</span></div>
    </div>
    <div id="blood-bar-container" style="display:none">
      <div class="blood-bar-wrap">
        <div class="blood-label">ğŸ©¸</div>
        <div class="blood-bar-track" id="blood-track">
          <div class="blood-bar-fill" id="bar-blood" style="width:0%"></div>
        </div>
        <div class="blood-val"><span id="p-blood">0</span>/<span id="p-mblood">100</span></div>
      </div>
    </div>
    <!-- ë„í™”ì„  ê²Œì´ì§€ (í­íƒ„ë³‘ ì „ìš©) -->
    <div id="fuse-bar-container" style="display:none">
      <div class="fuse-bar-wrap">
        <div class="fuse-label">ğŸ§¨</div>
        <div class="fuse-bar-track" id="fuse-track">
          <div class="fuse-bar-fill" id="bar-fuse" style="width:0%"></div>
        </div>
        <div class="fuse-val"><span id="p-fuse">0</span>/<span id="p-mfuse">100</span></div>
      </div>
    </div>
    <div class="bar-wrap">
      <div class="bar-label">EXP</div>
      <div class="bar-track bar-exp"><div class="bar-fill" id="bar-exp" style="width:0%"></div></div>
      <div class="bar-val" id="exp-val" style="font-size:10px">0/30</div>
    </div>
  </div>

  <div class="skills-grid" id="skills-grid"></div>

  <div class="action-row">
    <button class="btn btn-gray" id="btn-basic" onclick="doBasic()">
      âš” ê¸°ë³¸ê³µê²©<br>
      <span id="basic-preview" style="font-size:10px;color:var(--blue)">DMG: -</span>
    </button>
    <button class="btn btn-gray" id="btn-defend" onclick="doDefend()">
      ğŸ›¡ ë°©ì–´<br>
      <span style="font-size:10px;color:var(--muted)">DEF+8 (1í„´)</span>
    </button>
    <button class="btn btn-gray" id="btn-hp-pot" onclick="useHpPot()">
      ğŸ§ª HPí¬ì…˜<br>
      <span id="hpot-cnt" style="font-size:10px;color:var(--muted)">0ê°œ</span>
    </button>
    <button class="btn btn-gray" id="btn-mp-pot" onclick="useMpPot()">
      ğŸ’§ MPí¬ì…˜<br>
      <span id="mpot-cnt" style="font-size:10px;color:var(--muted)">0ê°œ</span>
    </button>
  </div>

  <div class="log-box" id="log-box"></div>
</div>

<!-- ìƒì  -->
<div class="screen" id="screen-shop">
  <div class="shop-header">
    <div class="shop-title">ğŸª ìƒì </div>
    <div class="shop-gold">ğŸ’° <span id="shop-gold">0</span>G</div>
  </div>
  <div class="shop-player-bar" id="shop-player-bar"></div>
  <div class="shop-sec">ğŸ§ª ì†Œëª¨í’ˆ</div>
  <div class="potion-row">
    <div class="pot-card">
      <div class="pot-icon">ğŸ§ª</div>
      <div class="pot-name">HP í¬ì…˜</div>
      <div class="pot-eff">HP 55% ì¦‰ì‹œ íšŒë³µ</div>
      <div class="pot-cnt">ë³´ìœ  <span id="shop-hpot">0</span>ê°œ</div>
      <button class="btn btn-gold" style="width:100%;font-size:12px;padding:7px" id="shop-btn-hp" onclick="shopBuyHp()">20G êµ¬ë§¤</button>
    </div>
    <div class="pot-card">
      <div class="pot-icon">ğŸ’§</div>
      <div class="pot-name">MP í¬ì…˜</div>
      <div class="pot-eff">MP 50% ì¦‰ì‹œ íšŒë³µ</div>
      <div class="pot-cnt">ë³´ìœ  <span id="shop-mpot">0</span>ê°œ</div>
      <button class="btn btn-blue" style="width:100%;font-size:12px;padding:7px" id="shop-btn-mp" onclick="shopBuyMp()">15G êµ¬ë§¤</button>
    </div>
  </div>
  <div class="shop-sec">âš” ì¥ë¹„</div>
  <div class="shop-grid" id="shop-grid"></div>
  <div style="display:flex;gap:8px;margin-top:6px;">
    <button class="btn btn-gold" style="flex:1;padding:13px;font-size:14px" onclick="shopNext()">ë‹¤ìŒ ìŠ¤í…Œì´ì§€ â†’</button>
    <button class="btn btn-gray" style="padding:13px 14px" onclick="goTitle()">ğŸ </button>
  </div>
</div>

<!-- ê²°ê³¼ -->
<div class="screen" id="screen-result">
  <div class="result-big result-lose">DEFEAT</div>
  <div id="r-msg" style="color:var(--muted);font-size:13px;margin-bottom:4px"></div>
  <div class="result-card" id="r-card"></div>
  <button class="btn btn-gray" style="width:100%;margin-top:4px" onclick="goTitle()">ì²˜ìŒìœ¼ë¡œ</button>
</div>

<!-- ì—”ë”© -->
<div class="screen" id="screen-ending">
  <div style="text-align:center;padding-top:16px;">
    <div style="font-size:52px;margin-bottom:8px">ğŸ‰</div>
    <div id="ending-title" style="font-size:32px;font-weight:900;color:var(--gold);margin-bottom:4px">CLEAR!</div>
    <div style="font-size:13px;color:var(--muted);margin-bottom:12px">ë˜ì „ì„ ì •ë³µí–ˆìŠµë‹ˆë‹¤!</div>
    <div id="hardmode-unlock-notice" style="display:none;background:linear-gradient(135deg,#1a0a00,#2a1400);border:2px solid #ff6600;border-radius:10px;padding:12px 16px;margin-bottom:12px;text-align:left;">
      <div style="font-size:16px;font-weight:900;color:#ff8800;margin-bottom:4px">ğŸ”¥ í•˜ë“œëª¨ë“œ í•´ì œ!</div>
      <div style="font-size:12px;color:#c07040;line-height:1.7">ëª¨ë“  ìºë¦­í„°ì˜ <strong style="color:#ff8800">ATKÂ·DEFê°€ 15% ì¦ê°€</strong>í•©ë‹ˆë‹¤.<br>ë‹¤ìŒ ê²Œì„ë¶€í„° ê°•í™”ëœ ìŠ¤íƒ¯ìœ¼ë¡œ ì‹œì‘í•˜ì„¸ìš”!</div>
    </div>
    <div class="result-card" id="ending-card" style="text-align:left;margin-bottom:16px"></div>
    <div style="font-size:13px;color:var(--muted);margin-bottom:16px">ğŸ† ë‹¹ì‹ ì€ ì§„ì •í•œ ë˜ì „ ë¸Œë ˆì´ì»¤ì…ë‹ˆë‹¤!</div>
    <button class="btn btn-gold" style="width:100%;padding:14px;font-size:15px" onclick="goTitle()">ì²˜ìŒìœ¼ë¡œ</button>
  </div>
</div>

</div>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ë°ì´í„° â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let hardMode = localStorage.getItem('db_hardMode')==='true';
let selectedMode = 'normal';

const CLASSES=[
  { name:'ì „ì‚¬',  icon:'âš”ï¸', hp:165,mp:40,  atk:20,def:10, hpG:24,atkG:3,defG:1,mpG:4,
    skills:[
      {name:'ê°•íƒ€',    icon:'âš”ï¸',mp:8, cd:0,maxCd:2, type:'dmg',  mult:2.2,          desc:'ë‹¨ì¼ ATKÃ—2.2'},
      {name:'ë°©íŒ¨ëŒì§„', icon:'ğŸ›¡',mp:10,cd:0,maxCd:2, type:'dmg',  mult:1.6,selfBuff:{defB:7,t:2}, desc:'ATKÃ—1.6 + DEF+7 (2í„´)'},
      {name:'íšŒì˜¤ë¦¬',  icon:'ğŸŒ€',mp:15,cd:0,maxCd:4, type:'all',  mult:0.9,          desc:'ì „ì²´ ATKÃ—0.9'},
      {name:'ì „íˆ¬í•¨ì„±', icon:'ğŸ“£',mp:12,cd:0,maxCd:4, type:'buff', buff:{atkB:8,t:3}, desc:'ATK+8 (3í„´)'},
    ]
  },
  { name:'ë§ˆë²•ì‚¬', icon:'ğŸ”®', hp:100,mp:120, atk:10,def:3,  hpG:15,atkG:2,defG:1,mpG:18,
    skills:[
      {name:'íŒŒì´ì–´ë³¼', icon:'ğŸ”¥',mp:11,cd:0,maxCd:1, type:'dmg', mult:2.8,bonus:7,  desc:'ë‹¨ì¼ ATKÃ—2.8+7'},
      {name:'ë¸”ë¦¬ìë“œ', icon:'â„ï¸',mp:22,cd:0,maxCd:4, type:'all', mult:1.8,          desc:'ì „ì²´ ATKÃ—1.8'},
      {name:'ë²ˆê°œ',    icon:'âš¡',mp:28,cd:0,maxCd:5, type:'dmg', mult:5.0,bonus:12,  desc:'ë‹¨ì¼ ATKÃ—5.0+12'},
      {name:'ë§ˆë‚˜í¡ìˆ˜', icon:'ğŸ’œ',mp:0, cd:0,maxCd:4, type:'heal_mp',healMp:40,       desc:'MP +40'},
    ]
  },
  { name:'ë„ì ',  icon:'ğŸ—¡ï¸', hp:110,mp:70,  atk:18,def:5,  hpG:14,atkG:4,defG:1,mpG:9,
    skills:[
      {name:'ì´ì¤‘ì°Œë¥´ê¸°',icon:'ğŸ—¡ï¸',mp:10,cd:0,maxCd:1, type:'multi',mult:1.3,hits:2, desc:'ATKÃ—1.3 Ã—2íƒ€'},
      {name:'ë…ë‹¨ê²€',   icon:'â˜ ï¸',mp:14,cd:0,maxCd:2, type:'dmg',  mult:1.6,poison:true, desc:'ATKÃ—1.6 + ë…(3í„´)'},
      {name:'ì—°ë§‰íƒ„',   icon:'ğŸ’¨',mp:18,cd:0,maxCd:3, type:'buff', buff:{dodge:.5,t:2}, desc:'íšŒí”¼ 50% (2í„´)'},
      {name:'ì•”ì‚´',     icon:'ğŸŒ‘',mp:45,cd:0,maxCd:6, type:'dmg',  mult:6.0,          desc:'ë‹¨ì¼ ATKÃ—6.0'},
    ]
  },
  { name:'ë±€íŒŒì´ì–´', icon:'ğŸ§›', hp:120,mp:80, atk:19,def:6, hpG:18,atkG:3,defG:1,mpG:10,
    isVampire:true,
    maxBlood:100, blood:0,
    skills:[
      {name:'í¡í˜ˆ',       icon:'ğŸ©¸',mp:12,cd:0,maxCd:2, type:'drain',   mult:2.0, drainRatio:0.4, desc:'ATKÃ—2.0, í”¼í•´ì˜ 40% í¡ìˆ˜'},
      {name:'í˜ˆê¸° í­ë°œ',  icon:'ğŸ’¥',mp:20,cd:0,maxCd:4, type:'blood_burst', mult:1.4, bloodCost:50, desc:'í˜ˆê¸°50 ì†Œëª¨ Â· ì „ì²´ ATKÃ—1.4'},
      {name:'ë°•ì¥ êµ°ë‹¨',  icon:'ğŸ¦‡',mp:24,cd:0,maxCd:4, type:'drain_all',mult:1.2, drainRatio:0.3, desc:'ì „ì²´ ATKÃ—1.2, ê° 30% í¡ìˆ˜'},
      {name:'ë¶ˆì‚¬ì˜ í”¼',  icon:'ğŸŒ‘',mp:0, cd:0,maxCd:8, type:'blood_heal', bloodCost:70, healRatio:0.60, desc:'í˜ˆê¸°70 ì†Œëª¨ Â· HP 60% íšŒë³µ'},
    ]
  },
  { name:'ë©”ê°€ ë‚˜ì´íŠ¸', icon:'ğŸ›¡ï¸', hp:280,mp:0, atk:8,def:12, hpG:35,atkG:1,defG:2,mpG:0,
    isMegaKnight:true,
    skills:[
      {name:'ì² ë²½ ê°•íƒ€',  icon:'ğŸª¨',mp:0,cd:0,maxCd:2, type:'dmg',  mult:1.8,          desc:'ë‹¨ì¼ ATKÃ—1.8 Â· MPë¬´ì†Œëª¨'},
      {name:'ëŒ€ì§€ ì§„ë™',  icon:'ğŸŒ',mp:0,cd:0,maxCd:3, type:'all',  mult:0.7,          desc:'ì „ì²´ ATKÃ—0.7 Â· MPë¬´ì†Œëª¨'},
      {name:'ì² ê°‘ ë°©ì–´',  icon:'ğŸ°',mp:0,cd:0,maxCd:3, type:'buff', buff:{defB:15,t:3}, desc:'DEF+15 (3í„´) Â· MPë¬´ì†Œëª¨'},
      {name:'ë§¹ê³µê²©',     icon:'âš¡',mp:0,cd:0,maxCd:4, type:'multi',mult:1.0,hits:3,   desc:'ATKÃ—1.0 Ã—3íƒ€ Â· MPë¬´ì†Œëª¨'},
    ]
  },
  { name:'ë„¤í¬ë¡œë§¨ì„œ', icon:'ğŸ’€', hp:95,mp:100, atk:14,def:4, hpG:13,atkG:2,defG:1,mpG:12,
    isNecro:true,
    skills:[
      {name:'ì¢€ë¹„ ì†Œí™˜',   icon:'ğŸ§Ÿ',mp:18,cd:0,maxCd:3, type:'summon_zombie', desc:'ì¢€ë¹„ ì†Œí™˜ (HP90Â·ë°©íŒ¨+ê³µê²©)'},
      {name:'ì €ì£¼ ì†ê°€ë½', icon:'â˜ ï¸',mp:14,cd:0,maxCd:2, type:'dmg', mult:2.0, poison:true, desc:'ATKÃ—2.0 + ë…(3í„´)'},
      {name:'ì‹œì²´ í­ë°œ',   icon:'ğŸ’¥',mp:22,cd:0,maxCd:4, type:'necro_explode', desc:'ì¢€ë¹„ 1ê¸° ì†Œëª¨ â†’ ë‹¨ì¼ ê°•ë ¥ ê³µê²©'},
      {name:'ì–¸ë°ë“œ êµ°ë‹¨', icon:'ğŸ’€',mp:30,cd:0,maxCd:5, type:'all', mult:1.1, desc:'ì „ì²´ ATKÃ—1.1 ì•”í‘ ê³µê²©'},
    ]
  },
  { name:'ì‹ ', icon:'âœ¨', hp:999999,mp:999999, atk:999999,def:999999, hpG:0,atkG:0,defG:0,mpG:0,
    isGod:true,
    skills:[
      {name:'ì²œë²Œ',     icon:'âš¡',mp:0,cd:0,maxCd:1, type:'all',  mult:9999, desc:'ì „ì²´ ì¦‰ì‚¬ Â· ì‹ ì˜ ë¶„ë…¸'},
      {name:'ì‹ ì˜ ì†',  icon:'ğŸ‘',mp:0,cd:0,maxCd:1, type:'dmg',  mult:9999, desc:'ë‹¨ì¼ ì¦‰ì‚¬ Â· MPë¬´ì†Œëª¨'},
      {name:'ë¶ˆë©¸',     icon:'ğŸ’«',mp:0,cd:0,maxCd:2, type:'blood_heal', bloodCost:0, healRatio:1.0, desc:'HP 100% íšŒë³µ'},
      {name:'ì°½ì¡°',     icon:'ğŸŒŒ',mp:0,cd:0,maxCd:1, type:'all',  mult:99999,desc:'ìš°ì£¼ë¥¼ ì°½ì¡°í•œë‹¤'},
    ]
  },
  { name:'ëª¨ê¸°', icon:'ğŸ¦Ÿ', hp:1,mp:50, atk:45,def:0, hpG:0,atkG:5,defG:0,mpG:6,
    isMosquito:true,
    skills:[
      {name:'í¡í˜ˆ ì°Œë¥´ê¸°', icon:'ğŸ©¸',mp:10,cd:0,maxCd:1, type:'dmg',  mult:2.5,          desc:'ATKÃ—2.5 Â· ì´ˆê³ ì† ì°Œë¥´ê¸°'},
      {name:'ê¸‰ìŠµ',        icon:'ğŸ’¨',mp:14,cd:0,maxCd:2, type:'dmg',  mult:4.0,          desc:'ATKÃ—4.0 Â· ìˆœê°„ ê°•íƒ€'},
      {name:'êµ°ì§‘',        icon:'ğŸ¦Ÿ',mp:18,cd:0,maxCd:3, type:'all',  mult:1.5,          desc:'ì „ì²´ ATKÃ—1.5 Â· ë–¼ê³µê²©'},
      {name:'ì´ˆìŒíŒŒ',      icon:'ğŸ“¡',mp:22,cd:0,maxCd:4, type:'dmg',  mult:6.5,          desc:'ATKÃ—6.5 Â· ì¹˜ëª…ì  ì¼ê²©'},
    ]
  },
  // â•â• ì €ê²©ìˆ˜ â•â•
  // ê¸°ë³¸ 10% ìœ„ì¥ íšŒí”¼, í—¤ë“œìƒ·(30% í™•ë¥  2ë°° ë°ë¯¸ì§€), ê³µì¤‘ì§€ì›(ì „ì²´)
  { name:'ì €ê²©ìˆ˜', icon:'ğŸ¯', hp:105,mp:65, atk:22,def:4, hpG:16,atkG:4,defG:1,mpG:8,
    isSniper:true,
    baseDodge:0.10, // ê¸°ë³¸ 10% ìœ„ì¥ íšŒí”¼
    skills:[
      {name:'ì €ê²©ì´',    icon:'ğŸ”«',mp:14,cd:0,maxCd:1, type:'sniper_shot',  mult:3.0, headshotChance:0.30, desc:'ATKÃ—3.0 (30% í—¤ë“œìƒ·â†’Ã—2)'},
      {name:'ì—ë„ˆì§€ë“œë§í¬', icon:'ğŸ¥¤',mp:12,cd:0,maxCd:4, type:'sniper_drink', healRatio:0.30,             desc:'ìµœëŒ€ HPì˜ 30% ì¦‰ì‹œ íšŒë³µ'},
      {name:'ê³µì¤‘ì§€ì›',  icon:'âœˆï¸',mp:20,cd:0,maxCd:4, type:'all',          mult:1.6,                      desc:'ì „ì²´ ATKÃ—1.6 ê³µìŠµ'},
      {name:'ìì£¼í¬ ì§€ì›', icon:'ğŸ”¥',mp:28,cd:0,maxCd:6, type:'howitzer',  mult:6.0,                       desc:'ATKÃ—6.0 ê°•ë ¥ ë‹¨ì¼ í¬ê²© Â· ê¸´ ì¿¨íƒ€ì„'},
    ]
  },
  // â•â• í­íƒ„ë³‘ (ë²„í”„ë¨) â•â•
  // HP: 130 â†’ 155, ATK: 16 â†’ 20, hpG: 18 â†’ 22, atkG: 2 â†’ 3
  { name:'í­íƒ„ë³‘', icon:'ğŸ’£', hp:155,mp:60, atk:20,def:5, hpG:22,atkG:3,defG:1,mpG:8,
    isBomber:true,
    maxFuse:100, fuse:0,
    skills:[
      {name:'ìˆ˜ë¥˜íƒ„',    icon:'ğŸ’£',mp:10,cd:0,maxCd:2, type:'bomb_all', mult:1.0, fuseGain:20, desc:'ì „ì²´ ATKÃ—1.0 Â· ë„í™”ì„ +20'},
      {name:'í´ëŸ¬ìŠ¤í„°',  icon:'ğŸ‡',mp:16,cd:0,maxCd:3, type:'bomb_all', mult:1.4, fuseGain:30, desc:'ì „ì²´ ATKÃ—1.4 Â· ë„í™”ì„ +30'},
      {name:'ì—°ë§‰ í­íƒ„', icon:'ğŸ’¨',mp:14,cd:0,maxCd:3, type:'bomb_smoke', mult:0.7, fuseGain:15, desc:'ì „ì²´ ATKÃ—0.7 + ìì‹  DEF+12(2í„´)'},
      {name:'ì—°ì‡„ í­ë°œ', icon:'ğŸ”¥',mp:22,cd:0,maxCd:5, type:'bomb_chain', mult:2.2, fuseCost:70, fuseGain:0, desc:'ë„í™”ì„  70 ì†Œëª¨ Â· ì „ì²´ ATKÃ—2.2 Ã—2ì—°ì†'},
    ]
  },
];

const ENEMIES=[
  {name:'ìŠ¬ë¼ì„',     icon:'ğŸŸ¢', hp:30,  atk:6,  def:0,  exp:14,  gold:5},
  {name:'ê³ ë¸”ë¦°',     icon:'ğŸ‘º', hp:48,  atk:11, def:2,  exp:24,  gold:9},
  {name:'í•´ê³¨ì „ì‚¬',   icon:'ğŸ’€', hp:65,  atk:15, def:4,  exp:38,  gold:14},
  {name:'ì˜¤í¬',       icon:'ğŸ‘¹', hp:95,  atk:19, def:6,  exp:55,  gold:21},
  {name:'íŠ¸ë¡¤',       icon:'ğŸ§Ÿ', hp:140, atk:24, def:9,  exp:80,  gold:30},
  {name:'ë“œë˜ê³¤',     icon:'ğŸ‰', hp:230, atk:34, def:14, exp:170, gold:70},
  {name:'ë‹¤í¬ë‚˜ì´íŠ¸',  icon:'ğŸ—¡ï¸', hp:180, atk:28, def:11, exp:130, gold:50},
  {name:'ë§ˆì™•',       icon:'ğŸ‘¿', hp:195, atk:37, def:15, exp:300, gold:120},
  {name:'ê³¨ë ˜',       icon:'ğŸª¨', hp:260, atk:22, def:20, exp:150, gold:55},
  {name:'ë¶ˆì‚¬ì¡°',     icon:'ğŸ¦…', hp:200, atk:36, def:12, exp:160, gold:65},
];

const STAGE_CFG=[
  [0,0,0],[1,1],[1,2,0],[2,2,2],[3,7],
  [3,3,2,1],[4,4],[4,4,3],[5,3,2],[4,7],
  [6,6,3],[6,4,4],[8,3,3],[9,6],[7,8],
  [5,5,3,3],[6,9],[8,8,4],[5,6,9],[7,5,5],
];
const FINAL_STAGE=19;

const ITEMS=[
  {id:'sw1',name:'ë‚¡ì€ ê²€',    icon:'ğŸ—¡ï¸',slot:'weapon',atk:5,  def:0,  cost:20},
  {id:'sw2',name:'ê°•ì²  ê²€',    icon:'âš”ï¸', slot:'weapon',atk:13, def:0,  cost:65},
  {id:'sw3',name:'ë§ˆë²• ê²€',    icon:'âœ¨', slot:'weapon',atk:24, def:0,  cost:150},
  {id:'ar1',name:'ê°€ì£½ ê°‘ì˜·',  icon:'ğŸ¥‹', slot:'armor', atk:0,  def:6,  cost:20},
  {id:'ar2',name:'ì‚¬ìŠ¬ ê°‘ì˜·',  icon:'ğŸ›¡', slot:'armor', atk:0,  def:14, cost:65},
  {id:'ar3',name:'íŒê¸ˆ ê°‘ì˜·',  icon:'ğŸ°', slot:'armor', atk:0,  def:25, cost:150},
  {id:'rg1',name:'í˜ì˜ ë°˜ì§€',  icon:'ğŸ’', slot:'ring',  atk:7,  def:3,  cost:55},
  {id:'am1',name:'ìˆ˜í˜¸ ëª©ê±¸ì´',icon:'ğŸ“¿', slot:'amulet',atk:4,  def:9,  cost:55},
  {id:'mp1',name:'ë§ˆë‚˜ ê²°ì •',  icon:'ğŸ”·', slot:'mpreg', mpReg:0.6, cost:70, desc:'MP íšŒë³µëŸ‰ +60%'},
  {id:'mp2',name:'ë§ˆë‚˜ ìˆ˜ì •êµ¬',icon:'ğŸ”®', slot:'mpmax', mpMax:40,  cost:70, desc:'ìµœëŒ€ MP +40'},
];
const SLOT_LABEL={weapon:'ë¬´ê¸°',armor:'ë°©ì–´êµ¬',ring:'ë°˜ì§€',amulet:'ëª©ê±¸ì´',mpreg:'MPì•¡ì„¸ì„œë¦¬',mpmax:'MPì•¡ì„¸ì„œë¦¬'};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ìƒíƒœ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let classIdx=0, player=null, enemies=[], stage=0;
let targetIdx=0, gold=0, hpPots=3, mpPots=2;
let equipped={weapon:null,armor:null,ring:null,amulet:null,mpreg:null,mpmax:null};
let owned=[];
let buffs={};
let defending=false;
let playerTurn=true, busy=false;
let luQueue=[];
let zombies=[];
let usedPotionThisRun=false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ë„ì „ê³¼ì œ ì‹œìŠ¤í…œ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ACHIEVEMENTS = [
  { id:'first_clear',    icon:'ğŸ‰', name:'ì²« ë²ˆì§¸ í´ë¦¬ì–´',       desc:'ì²˜ìŒìœ¼ë¡œ 20ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í•˜ì„¸ìš”.',                      tier:'common',    check:()=> getTotalClears()>=1 },
  { id:'first_blood',    icon:'âš”ï¸', name:'ì²« ë²ˆì§¸ ì‚¬ëƒ¥',         desc:'ì²˜ìŒìœ¼ë¡œ ì ì„ ì²˜ì¹˜í•˜ì„¸ìš”.',                               tier:'common',    check:()=> getGlobalStat('kills')>=1 },
  { id:'stage10',        icon:'ğŸ—ºï¸', name:'ì¤‘ê°„ ì§€ì ',            desc:'ìŠ¤í…Œì´ì§€ 10ì— ë„ë‹¬í•˜ì„¸ìš”.',                               tier:'common',    check:()=> getGlobalStat('maxStage')>=10 },
  { id:'lv10',           icon:'â­', name:'ìˆ™ë ¨ì',               desc:'ë ˆë²¨ 10ì— ë„ë‹¬í•˜ì„¸ìš”.',                                   tier:'common',    check:()=> getGlobalStat('maxLv')>=10 },
  { id:'all_class',      icon:'ğŸ­', name:'ì§ì—… íƒí—˜ê°€',          desc:'ëª¨ë“  ê¸°ë³¸ ì§ì—…ìœ¼ë¡œ í•œ ë²ˆì”© í”Œë ˆì´í•˜ì„¸ìš”.',                 tier:'rare',      check:()=> ['ì „ì‚¬','ë§ˆë²•ì‚¬','ë„ì ','ë±€íŒŒì´ì–´','ë©”ê°€ ë‚˜ì´íŠ¸','ëª¨ê¸°','ë„¤í¬ë¡œë§¨ì„œ','í­íƒ„ë³‘','ì €ê²©ìˆ˜'].every(n=>getClassRecord(n)) },
  { id:'hard_clear',     icon:'ğŸ”¥', name:'í•˜ë“œ í´ë¦¬ì–´',          desc:'í•˜ë“œ ëª¨ë“œë¥¼ í´ë¦¬ì–´í•˜ì„¸ìš”.',                               tier:'rare',      check:()=> getGlobalStat('hardClears')>=1 },
  { id:'no_potion',      icon:'ğŸš«', name:'í¬ì…˜ ê¸ˆì§€',            desc:'í¬ì…˜ì„ í•œ ë²ˆë„ ì“°ì§€ ì•Šê³  ìŠ¤í…Œì´ì§€ 10 ëŒíŒŒ.',              tier:'rare',      check:()=> getGlobalStat('noPotionStage10')>=1 },
  { id:'zombie5',        icon:'ğŸ§Ÿ', name:'ì–¸ë°ë“œ êµ°ë‹¨',          desc:'ì¢€ë¹„ë¥¼ 5ë§ˆë¦¬ ì´ìƒ ë™ì‹œì— ìœ ì§€í•˜ì„¸ìš”.',                    tier:'rare',      check:()=> getGlobalStat('maxZombies')>=5 },
  { id:'mosquito_s5',    icon:'ğŸ¦Ÿ', name:'ì‚´ì•„ìˆë‹¤!',            desc:'ëª¨ê¸°ë¡œ ìŠ¤í…Œì´ì§€ 5ë¥¼ í´ë¦¬ì–´í•˜ì„¸ìš”.',                       tier:'rare',      check:()=> getClassStat('ëª¨ê¸°','bestStage')>=5 },
  { id:'lv20',           icon:'ğŸ’«', name:'ì „ì„¤ì˜ ê²½ì§€',          desc:'ë ˆë²¨ 20ì— ë„ë‹¬í•˜ì„¸ìš”.',                                   tier:'rare',      check:()=> getGlobalStat('maxLv')>=20 },
  { id:'infinite_25',    icon:'â™¾ï¸', name:'ë¬´í•œì˜ ë„ì „ì',        desc:'ë¬´í•œ ëª¨ë“œì—ì„œ ìŠ¤í…Œì´ì§€ 25ì— ë„ë‹¬í•˜ì„¸ìš”.',                 tier:'epic',      check:()=> getGlobalStat('infiniteMaxStage')>=25 },
  { id:'hard_nodeath',   icon:'ğŸ›¡ï¸', name:'ë¬´ê²°ì˜ ê¸°ì‚¬',          desc:'í•˜ë“œ ëª¨ë“œë¥¼ í¬ì…˜ ì—†ì´ í´ë¦¬ì–´í•˜ì„¸ìš”.',                     tier:'epic',      check:()=> getGlobalStat('hardNoPotionClear')>=1 },
  { id:'mosquito_clear', icon:'ğŸ¦Ÿ', name:'1%ì˜ ê¸°ì ',            desc:'ëª¨ê¸°ë¡œ 20ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í•˜ì„¸ìš”.',                       tier:'epic',      check:()=> getClassStat('ëª¨ê¸°','clears')>=1 },
  { id:'vampire_drain',  icon:'ğŸ©¸', name:'í”¼ì˜ êµ°ì£¼',            desc:'ë±€íŒŒì´ì–´ë¡œ ì´ í¡í˜ˆëŸ‰ 1000 ë‹¬ì„±.',                         tier:'epic',      check:()=> getGlobalStat('totalDrain')>=1000 },
  { id:'all_equip',      icon:'âš™ï¸', name:'ì™„ì „ ë¬´ì¥',            desc:'ëª¨ë“  ì¥ë¹„ ìŠ¬ë¡¯ì„ ì±„ìš´ ì±„ë¡œ ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´.',             tier:'epic',      check:()=> getGlobalStat('fullEquipClear')>=1 },
  { id:'true_god',       icon:'âœ¨', name:'ê¹¨ë‹¬ì€ ì',            desc:'ì¹˜íŠ¸ ì½”ë“œë¡œ ì‹  ìºë¦­í„°ë¥¼ í•´ê¸ˆí•˜ì„¸ìš”.',                     tier:'legendary', check:()=> godUnlocked },
  { id:'all_clear',      icon:'ğŸ‰', name:'ë˜ì „ ë¸Œë ˆì´ì»¤',        desc:'ëª¨ë“  ì§ì—…(ì‹  ì œì™¸)ìœ¼ë¡œ 20ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í•˜ì„¸ìš”.',       tier:'legendary', check:()=> ['ì „ì‚¬','ë§ˆë²•ì‚¬','ë„ì ','ë±€íŒŒì´ì–´','ë©”ê°€ ë‚˜ì´íŠ¸','ëª¨ê¸°','ë„¤í¬ë¡œë§¨ì„œ','í­íƒ„ë³‘','ì €ê²©ìˆ˜'].every(n=>getClassStat(n,'clears')>=1) },
  { id:'play30',         icon:'ğŸ®', name:'ì§„ì§œ í”Œë ˆì´ì–´',        desc:'ì´ 30íšŒ ì´ìƒ í”Œë ˆì´í•˜ì„¸ìš”.',                              tier:'legendary', check:()=> getGlobalStat('totalRuns')>=30 },
  { id:'infinite_50',    icon:'ğŸŒŒ', name:'ë¬´í•œì˜ ì§€ë°°ì',        desc:'ë¬´í•œ ëª¨ë“œì—ì„œ ìŠ¤í…Œì´ì§€ 50ì— ë„ë‹¬í•˜ì„¸ìš”.',                 tier:'legendary', check:()=> getGlobalStat('infiniteMaxStage')>=50 },
  { id:'bomber_chain',   icon:'ğŸ”¥', name:'í­íƒ„ê´‘',              desc:'í­íƒ„ë³‘ìœ¼ë¡œ ì—°ì‡„ í­ë°œì„ ì´ 5íšŒ ì´ìƒ ì‚¬ìš©í•˜ì„¸ìš”.',          tier:'epic',      check:()=> getGlobalStat('bomberChainCount')>=5 },
  { id:'bomber_clear',   icon:'ğŸ’£', name:'í­ë°œì ì¸ ë§ˆë¬´ë¦¬',      desc:'í­íƒ„ë³‘ìœ¼ë¡œ 20ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í•˜ì„¸ìš”.',                   tier:'epic',      check:()=> getClassStat('í­íƒ„ë³‘','clears')>=1 },
  { id:'meme_bomb_overkill', icon:'ğŸ¤¯', name:'ì´ê±° ë„ˆë¬´í•œ ê±° ì•„ëƒ?', desc:'í­íƒ„ë³‘ ê¸°ë³¸ê³µê²©ìœ¼ë¡œ ì „ì²´ ì ì—ê²Œ ë™ì‹œì— 100+ ë°ë¯¸ì§€ë¥¼ ì…íˆì„¸ìš”.', tier:'meme', check:()=> getGlobalStat('bomberOverkill')>=1 },
  { id:'meme_slime_loss', icon:'ğŸŸ¢', name:'ìŠ¬ë¼ì„í•œí…Œ ì¡Œë‹¤ê³ ?',   desc:'ìŠ¬ë¼ì„ì—ê²Œ ê²Œì„ ì˜¤ë²„ë¥¼ ë‹¹í•˜ì„¸ìš”. ë¶€ë„ëŸ½ì§€ ì•Šë‚˜ìš”?',      tier:'meme', check:()=> getGlobalStat('lostToSlime')>=1 },
  { id:'meme_defend_spam', icon:'ğŸ›¡ï¸', name:'ë°©ì–´ê°€ ìµœê³ ì•¼!',      desc:'í•œ ì „íˆ¬ì—ì„œ ë°©ì–´ë¥¼ 5ë²ˆ ì´ìƒ ì‚¬ìš©í•˜ì„¸ìš”.',                 tier:'meme', check:()=> getGlobalStat('maxDefendInBattle')>=5 },
  { id:'meme_no_skill',   icon:'ğŸ¤¡', name:'ìŠ¤í‚¬ì´ ë­”ì§€ ëª°ë¼ìš”',   desc:'ìŠ¤í‚¬ì„ í•œ ë²ˆë„ ì“°ì§€ ì•Šê³  ìŠ¤í…Œì´ì§€ 5ê¹Œì§€ ë„ë‹¬í•˜ì„¸ìš”.',    tier:'meme', check:()=> getGlobalStat('noSkillStage5')>=1 },
  { id:'meme_mosquito_streak', icon:'ğŸ°', name:'ì˜¤ëŠ˜ì˜ ëŸ­í‚¤ ëª¨ê¸°', desc:'ëª¨ê¸°ë¡œ 10í„´ ì—°ì†ìœ¼ë¡œ íšŒí”¼ì— ì„±ê³µí•˜ì„¸ìš”.',                tier:'meme', check:()=> getGlobalStat('mosquitoStreak')>=10 },
  { id:'meme_zombie_cemetery', icon:'ğŸª¦', name:'ì¢€ë¹„ ë¬˜ì§€ ì£¼ì¸',   desc:'í•œ ê²Œì„ì—ì„œ ì¢€ë¹„ë¥¼ 10ë§ˆë¦¬ ì´ìƒ ìƒìœ¼ì„¸ìš”.',               tier:'meme', check:()=> getGlobalStat('zombieDead')>=10 },
  { id:'meme_potion_hoarder', icon:'ğŸº', name:'í¬ì…˜ ìˆ˜ì§‘ê°€',       desc:'í¬ì…˜ì„ 10ê°œ ì´ìƒ ë³´ìœ í•˜ì„¸ìš”.',                           tier:'meme', check:()=> getGlobalStat('maxPotionOwned')>=10 },
  { id:'meme_rich_die', icon:'ğŸ’¸', name:'ë¶€ìë¡œ ì£½ê¸°',             desc:'ê³¨ë“œ 200G ì´ìƒ ë³´ìœ í•œ ì±„ë¡œ ê²Œì„ ì˜¤ë²„.',                  tier:'meme', check:()=> getGlobalStat('richDeath')>=1 },
  { id:'meme_god_slime', icon:'ğŸ˜‡', name:'ì‹ ë„ ìŠ¬ë¼ì„ì€ ë¬´ì„œì›Œ',   desc:'ì‹  ìºë¦­í„°ë¡œ ìŠ¬ë¼ì„ì—ê²Œ ê¸°ë³¸ ê³µê²© 5ë²ˆ ì´ìƒ ì‚¬ìš©.',        tier:'meme', check:()=> getGlobalStat('godVsSlime')>=5 },
  { id:'meme_lv1_boss',  icon:'ğŸ’€', name:'ë¬´ëª¨í•œ ë„ì „ì',          desc:'ë ˆë²¨ 1ì¸ ì±„ë¡œ ë³´ìŠ¤ ìŠ¤í…Œì´ì§€(5ìŠ¤í…Œì´ì§€)ì— ì§„ì…í•˜ì„¸ìš”.',   tier:'meme', check:()=> getGlobalStat('lv1BossEntry')>=1 },
  { id:'meme_necro_rip',  icon:'âš°ï¸', name:'ë‚´ ì†Œì¤‘í•œ ì¢€ë¹„...',     desc:'ì†Œí™˜í•œ ì§í›„ ë‹¤ìŒ í„´ì— ì¢€ë¹„ê°€ ë°”ë¡œ ì‚¬ë§í•˜ëŠ” ê²½í—˜ì„ í•˜ì„¸ìš”.',tier:'meme', check:()=> getGlobalStat('zombieInstaDead')>=1 },
  // â”€â”€ ì €ê²©ìˆ˜ ì „ìš© ì—…ì  â”€â”€
  { id:'sniper_headshot5', icon:'ğŸ¯', name:'í—¤ë“œí—Œí„°',            desc:'í•œ ê²Œì„ì—ì„œ í—¤ë“œìƒ·ì„ 5ë²ˆ ì´ìƒ ì„±ê³µí•˜ì„¸ìš”.',                tier:'rare',   check:()=> getGlobalStat('sniperHeadshotGame5')>=1 },
  { id:'sniper_clear',     icon:'ğŸ”«', name:'ì›ê±°ë¦¬ ì •ë³µì',       desc:'ì €ê²©ìˆ˜ë¡œ 20ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í•˜ì„¸ìš”.',                      tier:'epic',   check:()=> getClassStat('ì €ê²©ìˆ˜','clears')>=1 },
  { id:'meme_sniper_miss', icon:'ğŸ’¨', name:'30% ë¯¿ì—ˆëŠ”ë°...',     desc:'ì €ê²©ì´ì„ 10ë²ˆ ì—°ì†ìœ¼ë¡œ í—¤ë“œìƒ· ë¯¸ìŠ¤ í•˜ì„¸ìš”. ìš´ì´ ì—†ë„¤ìš”...' , tier:'meme',  check:()=> getGlobalStat('sniperMissStreak')>=10 },
];

const TIER_LABEL = { common:'ì¼ë°˜', rare:'í¬ê·€', epic:'ì—í”½', legendary:'ì „ì„¤', meme:'ğŸ˜‚ ìœ ë¨¸' };

function getAchievementKey(id){ return 'db_ach_'+id; }
function isAchUnlocked(id){ return !!localStorage.getItem(getAchievementKey(id)); }
function getAchUnlockDate(id){ return localStorage.getItem(getAchievementKey(id))||''; }
function unlockAchievement(id){
  if(isAchUnlocked(id)) return false;
  const now = new Date();
  const label = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')}`;
  localStorage.setItem(getAchievementKey(id), label);
  return true;
}

function getGlobalStat(key){ return parseInt(localStorage.getItem('db_gstat_'+key)||'0'); }
function setGlobalStat(key,val){ localStorage.setItem('db_gstat_'+key, val); }
function incGlobalStat(key,amt=1){ setGlobalStat(key, getGlobalStat(key)+amt); }

function getClassRecord(name){ return JSON.parse(localStorage.getItem('db_rec_'+name)||'null'); }
function getClassStat(name,key){ const r=getClassRecord(name); return r?r[key]||0:0; }
function getTotalClears(){ return CLASSES.map(c=>getClassStat(c.name,'clears')).reduce((a,b)=>a+b,0); }

function checkAchievements(){
  ACHIEVEMENTS.forEach(ach=>{
    if(isAchUnlocked(ach.id)) return;
    try {
      if(ach.check()){
        unlockAchievement(ach.id);
        showAchToast(ach);
      }
    } catch(e){}
  });
}

function showAchToast(ach){
  const el=document.createElement('div');
  el.className='ach-toast';
  const isMeme = ach.tier==='meme';
  el.innerHTML=`<div class="ach-toast-icon">${ach.icon}</div>
    <div class="ach-toast-text">
      <div class="ach-toast-title">${isMeme?'ğŸ˜‚ ìœ ë¨¸ ë‹¬ì„±!':'ğŸ… ë„ì „ê³¼ì œ ë‹¬ì„±!'}</div>
      <div class="ach-toast-name">${ach.name}</div>
    </div>`;
  el.style.borderColor = isMeme ? '#80cc40' : 'var(--gold)';
  document.body.appendChild(el);
  setTimeout(()=>el.remove(), 3100);
}

function showAchievements(){
  const unlocked = ACHIEVEMENTS.filter(a=>isAchUnlocked(a.id)).length;
  const total = ACHIEVEMENTS.length;
  document.getElementById('ach-subtitle').textContent=`ë‹¬ì„±: ${unlocked} / ${total}`;
  document.getElementById('ach-progress-fill').style.width=(unlocked/total*100)+'%';
  const grid=document.getElementById('ach-grid');
  grid.innerHTML='';
  ACHIEVEMENTS.forEach(ach=>{
    const done=isAchUnlocked(ach.id);
    const date=getAchUnlockDate(ach.id);
    const d=document.createElement('div');
    d.className='ach-card'+(done?' unlocked '+ach.tier:'');
    d.innerHTML=`
      <div class="ach-icon${done?'':' locked'}">${ach.icon}</div>
      <div class="ach-info">
        <div class="ach-name">${done?ach.name:'???'}</div>
        <div class="ach-desc">${done?ach.desc:'ì•„ì§ ë‹¬ì„±í•˜ì§€ ëª»í•œ ë„ì „ê³¼ì œì…ë‹ˆë‹¤.'}</div>
        ${done&&date?`<div class="ach-date">ğŸ—“ ${date} ë‹¬ì„±</div>`:''}
      </div>
      <div class="ach-badge ${done?ach.tier:'locked-badge'}">${done?TIER_LABEL[ach.tier]:'ğŸ”’'}</div>
    `;
    grid.appendChild(d);
  });
  showScreen('achievements');
}

function getRecordKey(className){ return 'db_rec_'+className; }

function saveRecord(isVictory){
  const key = getRecordKey(player.name);
  const prev = JSON.parse(localStorage.getItem(key)||'null');
  const cur = {
    bestStage: stage+1,
    bestLv: player.lv,
    totalRuns: 1,
    clears: isVictory ? 1 : 0,
    bestMode: selectedMode,
    lastMode: selectedMode,
  };
  if(prev){
    cur.totalRuns = prev.totalRuns + 1;
    cur.clears = prev.clears + (isVictory ? 1 : 0);
    cur.bestStage = Math.max(prev.bestStage, stage+1);
    cur.bestLv = Math.max(prev.bestLv, player.lv);
    cur.bestMode = prev.bestMode;
    const modeScore = m => m==='hard'?3:m==='infinite'?2:1;
    if(modeScore(selectedMode) > modeScore(prev.bestMode)) cur.bestMode = selectedMode;
    else if(modeScore(selectedMode)===modeScore(prev.bestMode) && stage+1 >= prev.bestStage) cur.bestMode = selectedMode;
  }
  localStorage.setItem(key, JSON.stringify(cur));

  incGlobalStat('totalRuns');
  const prevMax = getGlobalStat('maxStage');
  if(stage+1 > prevMax) setGlobalStat('maxStage', stage+1);
  const prevLv = getGlobalStat('maxLv');
  if(player.lv > prevLv) setGlobalStat('maxLv', player.lv);
  if(isVictory && selectedMode==='hard') incGlobalStat('hardClears');
  if(selectedMode==='infinite'){
    const prevInf = getGlobalStat('infiniteMaxStage');
    if(stage+1 > prevInf) setGlobalStat('infiniteMaxStage', stage+1);
  }
  if(stage+1>=10 && !usedPotionThisRun) incGlobalStat('noPotionStage10');
  if(isVictory && selectedMode==='hard' && !usedPotionThisRun) incGlobalStat('hardNoPotionClear');
  if(player.isNecro){
    const alive=zombies.filter(z=>z.hp>0).length;
    const prevZ=getGlobalStat('maxZombies');
    if(alive>prevZ) setGlobalStat('maxZombies',alive);
  }
  if(isVictory){
    const slots=['weapon','armor','ring','amulet'];
    if(slots.every(s=>equipped[s])) incGlobalStat('fullEquipClear');
  }
  if(!isVictory && gold>=200) incGlobalStat('richDeath');
  if(stage+1>=5 && !skillUsedThisRun) incGlobalStat('noSkillStage5');

  checkAchievements();
}

function showRecord(classIdx){
  const c = CLASSES[classIdx];
  const key = getRecordKey(c.name);
  const rec = JSON.parse(localStorage.getItem(key)||'null');
  const box = document.getElementById('record-box');
  box.className = 'record-box'+(c.isVampire?' vampire-rec':c.isMegaKnight?' mk-rec':c.isMosquito?' mosquito-rec':c.isNecro?' necro-rec':c.isGod?' god-rec':c.isBomber?' bomb-rec':'');
  document.getElementById('rec-avatar').textContent = c.icon;
  document.getElementById('rec-title').textContent = c.name;
  const body = document.getElementById('rec-body');
  if(!rec){
    body.innerHTML=`<div class="rec-empty">ğŸ“­ ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì´ ì§ì—…ìœ¼ë¡œ ê²Œì„ì„ í”Œë ˆì´í•´ë³´ì„¸ìš”!</div>`;
  } else {
    const modeLabel = rec.bestMode==='hard'?'ğŸ”¥ í•˜ë“œ':rec.bestMode==='infinite'?'â™¾ï¸ ë¬´í•œ':'âš”ï¸ ì¼ë°˜';
    const lastLabel = rec.lastMode==='hard'?'ğŸ”¥ í•˜ë“œ':rec.lastMode==='infinite'?'â™¾ï¸ ë¬´í•œ':'âš”ï¸ ì¼ë°˜';
    const clearRate = rec.totalRuns>0 ? Math.round(rec.clears/rec.totalRuns*100) : 0;
    body.innerHTML=`
      <div class="rec-row"><span class="rec-label">ğŸ† ìµœê³  ìŠ¤í…Œì´ì§€</span><span class="rec-val">STAGE ${rec.bestStage}</span></div>
      <div class="rec-row"><span class="rec-label">â­ ìµœê³  ë ˆë²¨</span><span class="rec-val">Lv ${rec.bestLv}</span></div>
      <div class="rec-row"><span class="rec-label">ğŸ® ìµœê³  ê¸°ë¡ ëª¨ë“œ</span><span class="rec-val">${modeLabel}</span></div>
      <div class="rec-row"><span class="rec-label">ğŸ”„ ì´ í”Œë ˆì´</span><span class="rec-val">${rec.totalRuns}íšŒ</span></div>
      <div class="rec-row"><span class="rec-label">ğŸ‰ í´ë¦¬ì–´ íšŸìˆ˜</span><span class="rec-val">${rec.clears}íšŒ</span></div>
      <div class="rec-row"><span class="rec-label">ğŸ“Š í´ë¦¬ì–´ìœ¨</span><span class="rec-val">${clearRate}%</span></div>
      <div class="rec-row"><span class="rec-label">ğŸ“… ë§ˆì§€ë§‰ ëª¨ë“œ</span><span class="rec-val">${lastLabel}</span></div>
    `;
  }
  document.getElementById('record-overlay').style.display='flex';
}
function closeRecord(){ document.getElementById('record-overlay').style.display='none'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì¹˜íŠ¸ ì½”ë“œ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let godUnlocked = localStorage.getItem('db_godUnlocked')==='true';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì €ê²©ìˆ˜ ì „ìš© ë³€ìˆ˜ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sniperAimReady = false;   // ì €ê²© ì¡°ì¤€ ë°œë™ ì—¬ë¶€ (ë‹¤ìŒ ê³µê²© í—¤ë“œìƒ· 100%)
let sniperHeadshotCount = 0;  // ì´ë²ˆ ê²Œì„ í—¤ë“œìƒ· íšŸìˆ˜

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ìœ ë¨¸ ì—…ì  ì¶”ì  ë³€ìˆ˜ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let defendCountInBattle = 0;
let skillUsedThisRun = false;
let mosquitoStreakCount = 0;
let zombieJustSummoned = false;
let zombieDeadThisRun = 0;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• íƒ€ì´í‹€ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  const row=document.getElementById('class-row');
  CLASSES.forEach((c,i)=>{
    if(c.isGod && !godUnlocked) return;
    const d=document.createElement('div');
    d.className='cls-card'
      +(c.isVampire?' vampire-card':c.isMegaKnight?' mk-card':c.isMosquito?' mosquito-card':c.isNecro?' necro-card':c.isGod?' god-card':c.isBomber?' bomb-card':c.isSniper?' sniper-card':'')
      +(i===0?' sel':'');
    d.innerHTML=`<div class="cls-icon">${c.icon}</div>
      <div class="cls-name">${c.name}</div>
      <div class="cls-desc">HP ${c.isGod?'âˆ':c.hp}  ATK ${c.isGod?'âˆ':c.atk}  DEF ${c.isGod?'âˆ':c.def}${
        c.isVampire?`<br>MP ${c.mp} Â· ğŸ©¸ í˜ˆê¸° ì‹œìŠ¤í…œ`
        :c.isMegaKnight?'<br>ğŸ›¡ MP ì†Œëª¨ ì—†ìŒ'
        :c.isMosquito?'<br>ğŸ’¨ 99% íšŒí”¼ Â· DEF ê³ ì • 0'
        :c.isNecro?`<br>MP ${c.mp} Â· ğŸ§Ÿ ì¢€ë¹„ ì†Œí™˜`
        :c.isGod?'<br>âš¡ ë¶ˆë©¸ Â· ì „ëŠ¥ Â· ë¬´í•œ'
        :c.isBomber?`<br>MP ${c.mp} Â· ğŸ’£ ì „ì²´ê³µê²© ì „ë¬¸`
        :c.isSniper?`<br>MP ${c.mp} Â· ğŸ¯ í—¤ë“œìƒ· Â· 10%íšŒí”¼`
        :`<br>MP ${c.mp}`
      }</div>`;
    d.onclick=()=>{
      if(classIdx===i && document.querySelectorAll('.cls-card')[i]?.classList.contains('sel')){
        showRecord(i); return;
      }
      classIdx=i;
      document.querySelectorAll('.cls-card').forEach(x=>x.classList.remove('sel'));
      d.classList.add('sel');
    };
    row.appendChild(d);
  });
  updateModeUI();
})();

function submitCheat(){
  const input = document.getElementById('cheat-input');
  const result = document.getElementById('cheat-result');
  const val = input.value.trim();
  if(val === 'ì´ì§€ìœ¨'){
    godUnlocked = true;
    localStorage.setItem('db_godUnlocked','true');
    result.style.display='block';
    result.className='cheat-result ok';
    result.innerHTML=`âœ… <strong style="color:#ffd700">ACCESS GRANTED</strong><br>ğŸŒŒ ì‹ (ç¥) ìºë¦­í„°ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤!`;
    input.value='';
    const row=document.getElementById('class-row');
    if(!document.querySelector('.god-card')){
      const c=CLASSES.find(x=>x.isGod);
      const idx=CLASSES.indexOf(c);
      const d=document.createElement('div');
      d.className='cls-card god-card';
      d.innerHTML=`<div class="cls-icon">${c.icon}</div>
        <div class="cls-name">${c.name}</div>
        <div class="cls-desc">HP âˆ  ATK âˆ  DEF âˆ<br>âš¡ ë¶ˆë©¸ Â· ì „ëŠ¥ Â· ë¬´í•œ</div>`;
      d.onclick=()=>{
        if(classIdx===idx && d.classList.contains('sel')){ showRecord(idx); return; }
        classIdx=idx;
        document.querySelectorAll('.cls-card').forEach(x=>x.classList.remove('sel'));
        d.classList.add('sel');
      };
      row.appendChild(d);
    }
    flashTerminal();
    checkAchievements();
  } else {
    result.style.display='none';
  }
  input.value='';
}

function flashTerminal(){
  const panel = document.querySelector('.cheat-panel');
  panel.style.borderColor='#ffd700';
  panel.style.boxShadow='0 0 30px #ffd70055';
  setTimeout(()=>{panel.style.borderColor='';panel.style.boxShadow='';},1500);
}

function startGame(){
  const c=CLASSES[classIdx];
  player={
    name:c.name,icon:c.icon,
    hp:c.hp,maxHp:c.hp,mp:c.mp,maxMp:c.mp,
    atk:c.atk,def:c.def,lv:1,exp:0,expNext:30,
    skills:JSON.parse(JSON.stringify(c.skills)),
    hpG:c.hpG,atkG:c.atkG,defG:c.defG,mpG:c.mpG,
    isVampire:c.isVampire||false,
    isMegaKnight:c.isMegaKnight||false,
    isMosquito:c.isMosquito||false,
    isGod:c.isGod||false,
    isNecro:c.isNecro||false,
    isBomber:c.isBomber||false,
    isSniper:c.isSniper||false,
    baseDodge:c.isSniper ? c.baseDodge : 0,
    blood: c.isVampire ? 0 : undefined,
    maxBlood: c.isVampire ? c.maxBlood : undefined,
    fuse: c.isBomber ? 0 : undefined,
    maxFuse: c.isBomber ? c.maxFuse : undefined,
  };
  gold=0; hpPots=3; mpPots=2; stage=0;
  equipped={weapon:null,armor:null,ring:null,amulet:null};
  owned=[]; buffs={}; luQueue=[]; zombies=[]; usedPotionThisRun=false;
  defendCountInBattle=0; skillUsedThisRun=false;
  mosquitoStreakCount=0; zombieDeadThisRun=0; zombieJustSummoned=false;
  sniperAimReady=false; sniperHeadshotCount=0;

  applyVampireTheme(player.isVampire);
  const pc=document.getElementById('player-card');
  if(player.isMegaKnight){ pc.classList.add('mk-theme'); pc.classList.remove('mosquito-theme','god-theme','necro-theme','bomb-theme','sniper-theme'); }
  else if(player.isMosquito){ pc.classList.add('mosquito-theme'); pc.classList.remove('mk-theme','god-theme','necro-theme','bomb-theme','sniper-theme'); }
  else if(player.isGod){ pc.classList.add('god-theme'); pc.classList.remove('mk-theme','mosquito-theme','necro-theme','bomb-theme','sniper-theme'); }
  else if(player.isNecro){ pc.classList.add('necro-theme'); pc.classList.remove('mk-theme','mosquito-theme','god-theme','bomb-theme','sniper-theme'); }
  else if(player.isBomber){ pc.classList.add('bomb-theme'); pc.classList.remove('mk-theme','mosquito-theme','god-theme','necro-theme','sniper-theme'); }
  else if(player.isSniper){ pc.classList.add('sniper-theme'); pc.classList.remove('mk-theme','mosquito-theme','god-theme','necro-theme','bomb-theme'); }
  else { pc.classList.remove('mk-theme','mosquito-theme','god-theme','necro-theme','bomb-theme','sniper-theme'); }

  document.getElementById('fuse-bar-container').style.display = player.isBomber ? 'block' : 'none';
  document.getElementById('zombie-zone-wrap').style.display = player.isNecro ? 'block' : 'none';
  if(hardMode && selectedMode==='hard') addLog('ğŸ”¥ í•˜ë“œëª¨ë“œ í™œì„±í™”! ATKÂ·DEF +15% ì ìš© ì¤‘','s');

  showScreen('battle');
  loadStage();
}

function applyVampireTheme(isVampire){
  const pc=document.getElementById('player-card');
  const bloodContainer=document.getElementById('blood-bar-container');
  const hpTrack=document.getElementById('hp-track');
  const mpTrack=document.getElementById('mp-track');
  const mpLabel=document.getElementById('mp-label');
  const mpBarWrap=document.getElementById('mp-bar-wrap');
  const mpPotBtn=document.getElementById('btn-mp-pot');
  mpBarWrap.style.display='flex';
  if(mpPotBtn) mpPotBtn.style.display='block';
  if(isVampire){
    pc.classList.add('vampire-theme');
    bloodContainer.style.display='block';
    hpTrack.classList.add('vampire-bar');
    mpTrack.classList.add('vampire-bar');
    mpLabel.textContent='MP';
  } else {
    pc.classList.remove('vampire-theme');
    bloodContainer.style.display='none';
    hpTrack.classList.remove('vampire-bar');
    mpTrack.classList.remove('vampire-bar');
    mpLabel.textContent='MP';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ìŠ¤í…Œì´ì§€ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadStage(){
  defending=false; buffs={}; busy=false; playerTurn=true; victoryPending=false; victoryDone=false;
  defendCountInBattle=0;
  zombieJustSummoned=false;

  let cfg;
  if(selectedMode==='infinite' && stage >= FINAL_STAGE){
    const infiniteRound = stage - FINAL_STAGE + 1;
    const pool = infiniteRound<=3 ? [4,5,6] : infiniteRound<=6 ? [5,6,7,8] : [6,7,8,9];
    const count = infiniteRound<=2 ? 2 : infiniteRound<=5 ? 3 : 3;
    cfg = Array.from({length:count}, ()=> pool[Math.floor(Math.random()*pool.length)]);
  } else {
    cfg = STAGE_CFG[Math.min(stage, FINAL_STAGE)];
  }

  const sc=1+stage*0.12;
  enemies=cfg.map((ei,i)=>{
    const t=ENEMIES[ei];
    return{
      ...t,
      hp:Math.floor(t.hp*sc), maxHp:Math.floor(t.hp*sc),
      atk:Math.floor(t.atk*(1+stage*.08)),
      def:Math.floor(t.def*(1+stage*.07)),
      exp:Math.floor(t.exp*(1+stage*.06)),
      gold:Math.floor(t.gold*(1+stage*.06)),
      poison:null, id:i,
    };
  });

  const bossStages=[4,9,14,19];
  const isBoss = selectedMode!=='infinite'
    ? bossStages.includes(stage)
    : bossStages.includes(stage) || (stage>=FINAL_STAGE && (stage-FINAL_STAGE+1)%5===0);
  const badge=document.getElementById('stage-badge');
  badge.textContent=`STAGE ${stage+1}${isBoss?' ğŸ‘¿BOSS':''}`;
  badge.style.borderColor=isBoss?'#e05050':'#b8860b';
  badge.style.color=isBoss?'#e05050':'var(--gold)';

  if(isBoss && player.lv===1) incGlobalStat('lv1BossEntry');

  targetIdx=0;
  player.skills.forEach(s=>{if(s.cd>0)s.cd--;});
  clearLog();
  player.mp = player.maxMp + effMaxMpBonus();
  addLog(`${isBoss?'ğŸ‘¿ BOSS':'âš”'} STAGE ${stage+1} ì‹œì‘! ì  ${enemies.length}ë§ˆë¦¬!`, isBoss?'e':'s');
  if(selectedMode==='infinite' && stage>=FINAL_STAGE) addLog(`â™¾ï¸ ë¬´í•œ ë„ì „ ${stage-FINAL_STAGE+1}ë²ˆì§¸ êµ¬ê°„!`,'s');
  if(player.isVampire) addLog('ğŸ©¸ ê³µê²© ì‹œ í˜ˆê¸°ê°€ ì¶©ì „ë©ë‹ˆë‹¤!','v');
  renderAll();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• í˜ˆê¸° ì‹œìŠ¤í…œ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gainBlood(amount){
  if(!player.isVampire) return;
  player.blood=Math.min(player.maxBlood, player.blood+amount);
  updateHud();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ë„í™”ì„ (Fuse) ì‹œìŠ¤í…œ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gainFuse(amount){
  if(!player.isBomber) return;
  player.fuse=Math.min(player.maxFuse, player.fuse+amount);
  updateHud();
}
function spendFuse(amount){
  if(!player.isBomber) return false;
  if(player.fuse<amount) return false;
  player.fuse-=amount;
  updateHud();
  return true;
}
function showBombFloat(enId, dmg){
  const card=document.getElementById('en-'+enId);
  if(!card) return;
  const el=document.createElement('div');
  el.className='float-bomb';
  el.textContent='ğŸ’¥'+dmg;
  card.appendChild(el);
  setTimeout(()=>el.remove(),900);
}
function showHeadshotFloat(enId){
  const card=document.getElementById('en-'+enId);
  if(!card) return;
  const el=document.createElement('div');
  el.className='float-headshot';
  el.textContent='ğŸ¯ í—¤ë“œìƒ·!!';
  card.appendChild(el);
  setTimeout(()=>el.remove(),1000);
}
function spendBlood(amount){
  if(!player.isVampire) return false;
  if(player.blood<amount) return false;
  player.blood-=amount;
  updateHud();
  return true;
}
function onPlayerHit(dmg){
  if(player.isVampire){
    const gain=Math.max(3, Math.floor(dmg*0.3));
    gainBlood(gain);
    addLog(`ğŸ©¸ í”¼í•´ë¡œ í˜ˆê¸° +${gain} (${player.blood}/${player.maxBlood})`,'v');
  }
}
function drainHeal(dmg, ratio){
  const heal=Math.max(1, Math.floor(dmg*ratio));
  player.hp=Math.min(player.maxHp, player.hp+heal);
  gainBlood(Math.floor(heal*0.4));
  incGlobalStat('totalDrain', heal);
  updateHud();
  return heal;
}
function showDrainFloat(heal){
  const pc=document.getElementById('player-card');
  const rect=pc.getBoundingClientRect();
  const el=document.createElement('div');
  el.className='float-heal';
  el.textContent=`ğŸ©¸+${heal}`;
  el.style.left=(rect.left+rect.width/2)+'px';
  el.style.top=(rect.top+window.scrollY-10)+'px';
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),1000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì „íˆ¬ ì•¡ì…˜ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doBasic(){
  if(!canAct()) return;

  if(player.isBomber){
    const aliveEn = enemies.filter(e=>e.hp>0);
    if(aliveEn.length===0) return;
    let tot=0;
    const mpReg=Math.max(1,Math.floor(player.maxMp*.06 * effMpRegMult()));
    aliveEn.forEach(en=>{
      const dmg=calcDmg(effAtk()*0.8, en.def);
      dealDmg(en, dmg);
      tot+=dmg;
    });
    player.mp=Math.min(player.maxMp,player.mp+mpReg);
    const fuseGain=Math.max(5, Math.floor(tot*0.12));
    gainFuse(fuseGain);
    if(aliveEn.length>0 && tot/aliveEn.length>=100) incGlobalStat('bomberOverkill');
    checkAchievements();
    addLog(`ğŸ’£ ìˆ˜ë¥˜íƒ„ íˆ¬ì²™ â†’ ì „ì²´ ê³µê²©! ì´ ${tot} ë°ë¯¸ì§€ / ğŸ§¨ë„í™”ì„ +${fuseGain}`,'p');
    tryEndPlayerTurn();
    return;
  }

  const en=getTarget(); if(!en) return;
  const dmg=calcDmg(effAtk()*0.8, en.def);
  const mpReg=Math.max(1,Math.floor(player.maxMp*.06 * effMpRegMult()));
  dealDmg(en, dmg);
  player.mp=Math.min(player.maxMp,player.mp+mpReg);

  if(player.isGod && en.name==='ìŠ¬ë¼ì„'){
    incGlobalStat('godVsSlime');
    checkAchievements();
  }

  if(player.isVampire){
    const bg=Math.max(1, Math.floor(dmg*0.1));
    gainBlood(bg);
    addLog(`âš” ê¸°ë³¸ ê³µê²© â†’ ${en.name} ${dmg} ë°ë¯¸ì§€ / MP+${mpReg} / ğŸ©¸í˜ˆê¸°+${bg}`,'p');
  } else {
    addLog(`âš” ê¸°ë³¸ ê³µê²© â†’ ${en.name} ${dmg} ë°ë¯¸ì§€ / MP +${mpReg}`,'p');
  }
  tryEndPlayerTurn();
}

function doDefend(){
  if(!canAct()) return;
  defending=true;
  buffs.defB=(buffs.defB||0)+8;
  buffs.defTurns=2;
  defendCountInBattle++;
  const prev=getGlobalStat('maxDefendInBattle');
  if(defendCountInBattle>prev) setGlobalStat('maxDefendInBattle',defendCountInBattle);
  checkAchievements();
  addLog('ğŸ›¡ ë°©ì–´ íƒœì„¸! DEF +8 (ë‹¤ìŒ í„´ê¹Œì§€)','p');
  tryEndPlayerTurn();
}

function useHpPot(){
  if(!canAct()||hpPots<=0) return;
  usedPotionThisRun=true;
  const ratio = player.isMegaKnight ? 0.2 : 0.55;
  const h=Math.floor(player.maxHp*ratio);
  player.hp=Math.min(player.maxHp,player.hp+h);
  hpPots--;
  const total=hpPots+mpPots;
  const prevMax=getGlobalStat('maxPotionOwned');
  if(total>prevMax) setGlobalStat('maxPotionOwned',total);
  addLog(`ğŸ§ª HP í¬ì…˜! +${h} íšŒë³µ (ë‚¨ì€ ${hpPots}ê°œ)`,'h');
  updateHud(); setActionBtns();
  checkAchievements();
  tryEndPlayerTurn();
}

function useMpPot(){
  if(!canAct()||mpPots<=0) return;
  usedPotionThisRun=true;
  const h=Math.floor(player.maxMp*.5 * effMpRegMult());
  player.mp=Math.min(player.maxMp+effMaxMpBonus(),player.mp+h);
  mpPots--;
  const total=hpPots+mpPots;
  const prevMax=getGlobalStat('maxPotionOwned');
  if(total>prevMax) setGlobalStat('maxPotionOwned',total);
  addLog(`ğŸ’§ MP í¬ì…˜! +${h} íšŒë³µ (ë‚¨ì€ ${mpPots}ê°œ)`,'h');
  updateHud(); setActionBtns();
  checkAchievements();
  tryEndPlayerTurn();
}

function useSkill(idx){
  if(!canAct()) return;
  const sk=player.skills[idx];
  if(sk.cd>0||player.mp<sk.mp) return;

  if(sk.bloodCost&&(!player.isVampire||player.blood<sk.bloodCost)&&!player.isGod){
    addLog(`ğŸ©¸ í˜ˆê¸° ë¶€ì¡±! (í•„ìš”: ${sk.bloodCost} / ë³´ìœ : ${player.blood||0})`,'v');
    return;
  }

  skillUsedThisRun = true;

  player.mp=Math.max(0,player.mp-sk.mp);
  sk.cd=sk.maxCd;

  if(sk.type==='bomb_all'){
    let tot=0;
    enemies.forEach(en=>{
      if(en.hp<=0) return;
      const dmg=calcDmg(effAtk()*(sk.mult||1), en.def);
      en.hp=Math.max(0,en.hp-dmg);
      showBombFloat(en.id, dmg);
      renderEnemies();
      if(en.hp<=0) onKill(en);
      tot+=dmg;
    });
    gainFuse(sk.fuseGain||0);
    addLog(`${sk.icon} ${sk.name} â†’ ì „ì²´ í­ë°œ! ì´ ${tot} ë°ë¯¸ì§€ ğŸ§¨ë„í™”ì„ +${sk.fuseGain||0}`,'p');
    updateHud(); renderSkills();
    tryEndPlayerTurn();
    return;

  } else if(sk.type==='bomb_smoke'){
    let tot=0;
    enemies.forEach(en=>{
      if(en.hp<=0) return;
      const dmg=calcDmg(effAtk()*(sk.mult||1), en.def);
      en.hp=Math.max(0,en.hp-dmg);
      showBombFloat(en.id, dmg);
      renderEnemies();
      if(en.hp<=0) onKill(en);
      tot+=dmg;
    });
    buffs.defB=(buffs.defB||0)+12; buffs.defTurns=2;
    gainFuse(sk.fuseGain||0);
    addLog(`${sk.icon} ${sk.name} â†’ ì „ì²´ ${tot} ë°ë¯¸ì§€! DEF+12 (2í„´) ğŸ§¨ë„í™”ì„ +${sk.fuseGain||0}`,'p');
    updateHud(); renderSkills();
    tryEndPlayerTurn();
    return;

  } else if(sk.type==='bomb_chain'){
    if(player.fuse<(sk.fuseCost||70)){
      addLog(`ğŸ§¨ ë„í™”ì„  ë¶€ì¡±! (í•„ìš”: ${sk.fuseCost} / ë³´ìœ : ${player.fuse})`,'e');
      sk.cd=0; player.mp+=sk.mp; return;
    }
    spendFuse(sk.fuseCost||70);
    let grand=0;
    for(let wave=0;wave<2;wave++){
      enemies.forEach(en=>{
        if(en.hp<=0) return;
        const dmg=calcDmg(effAtk()*(sk.mult||1), en.def);
        en.hp=Math.max(0,en.hp-dmg);
        showBombFloat(en.id, dmg);
        renderEnemies();
        if(en.hp<=0) onKill(en);
        grand+=dmg;
      });
    }
    addLog(`ğŸ”¥ ì—°ì‡„ í­ë°œ! ë„í™”ì„  ${sk.fuseCost} ì†Œëª¨ â†’ ì „ì²´ 2ì—°ì† í­ë°œ! ì´ ${grand} ë°ë¯¸ì§€!!!`,'p');
    incGlobalStat('bomberChainCount');
    incGlobalStat('bomberChainTotal', grand);
    checkAchievements();
    updateHud(); renderSkills();
    tryEndPlayerTurn();
    return;
  }

  // â”€â”€ ì €ê²©ìˆ˜ ìŠ¤í‚¬ â”€â”€
  if(sk.type==='sniper_shot'){
    const en=getTarget(); if(!en) return;
    const isHeadshot = sniperAimReady || (Math.random() < 0.30);
    sniperAimReady = false;
    let baseDmg = calcDmg(effAtk()*(sk.mult||1), en.def);
    let finalDmg = isHeadshot ? Math.floor(baseDmg*2) : baseDmg;
    dealDmg(en, finalDmg);
    if(isHeadshot){
      showHeadshotFloat(en.id);
      sniperHeadshotCount++;
      incGlobalStat('sniperHeadshots');
      setGlobalStat('sniperMissStreak', 0);
      if(sniperHeadshotCount>=5){
        incGlobalStat('sniperHeadshotGame5');
      }
      checkAchievements();
      addLog(`ğŸ”« ì €ê²©ì´ â†’ ${en.name} ğŸ¯í—¤ë“œìƒ·!! ${finalDmg} ë°ë¯¸ì§€! (ê¸°ë³¸ ${baseDmg}ì˜ 2ë°°!)`,'p');
    } else {
      incGlobalStat('sniperMissStreak');
      checkAchievements();
      addLog(`ğŸ”« ì €ê²©ì´ â†’ ${en.name} ${finalDmg} ë°ë¯¸ì§€!`,'p');
    }
    updateHud(); renderSkills();
    tryEndPlayerTurn();
    return;

  } else if(sk.type==='sniper_drink'){
    const heal = Math.floor(player.maxHp * (sk.healRatio||0.30));
    player.hp = Math.min(player.maxHp, player.hp + heal);
    showDrainFloat(heal);
    addLog(`ğŸ¥¤ ì—ë„ˆì§€ë“œë§í¬! HP +${heal} íšŒë³µ!`,'h');
    updateHud(); renderSkills();
    tryEndPlayerTurn();
    return;

  } else if(sk.type==='howitzer'){
    const en=getTarget(); if(!en) return;
    const dmg=calcDmg(effAtk()*(sk.mult||6.0), en.def);
    dealDmg(en, dmg);
    showHeadshotFloat(en.id);
    addLog(`ğŸ”¥ ìì£¼í¬ ì§€ì›! â†’ ${en.name}ì— ${dmg} í¬ê²© ë°ë¯¸ì§€!`,'p');
    updateHud(); renderSkills();
    tryEndPlayerTurn();
    return;
  }

  if(sk.type==='drain'){
    const en=getTarget(); if(!en) return;
    const dmg=calcDmg(effAtk()*(sk.mult||1), en.def);
    dealDmg(en, dmg);
    const heal=drainHeal(dmg, sk.drainRatio);
    showDrainFloat(heal);
    gainBlood(Math.max(8, Math.floor(dmg*0.35)));
    addLog(`ğŸ©¸ ${sk.name} â†’ ${en.name} ${dmg} ë°ë¯¸ì§€ / HP +${heal} í¡ìˆ˜!`,'v');

  } else if(sk.type==='drain_all'){
    let totalDmg=0, totalHeal=0;
    enemies.forEach(en=>{
      if(en.hp<=0) return;
      const dmg=calcDmg(effAtk()*(sk.mult||1), en.def);
      dealDmg(en, dmg);
      totalDmg+=dmg;
      totalHeal+=drainHeal(dmg, sk.drainRatio);
    });
    showDrainFloat(totalHeal);
    gainBlood(Math.max(12, Math.floor(totalDmg*0.25)));
    addLog(`ğŸ¦‡ ${sk.name} â†’ ì „ì²´ ${totalDmg} ë°ë¯¸ì§€ / HP +${totalHeal} í¡ìˆ˜!`,'v');

  } else if(sk.type==='blood_burst'){
    spendBlood(sk.bloodCost);
    let tot=0;
    enemies.forEach(en=>{
      if(en.hp<=0) return;
      const dmg=calcDmg(effAtk()*(sk.mult||1)+(player.blood*0.3), en.def);
      dealDmg(en,dmg); tot+=dmg;
    });
    addLog(`ğŸ’¥ ${sk.name} â†’ í˜ˆê¸° ${sk.bloodCost} ì†Œëª¨! ì „ì²´ ${tot} ë°ë¯¸ì§€!`,'v');

  } else if(sk.type==='blood_heal'){
    spendBlood(sk.bloodCost);
    const heal=Math.floor(player.maxHp*(sk.healRatio||0.35));
    player.hp=Math.min(player.maxHp, player.hp+heal);
    showDrainFloat(heal);
    updateHud();
    addLog(`ğŸŒ‘ ${sk.name} â†’ í˜ˆê¸° ${sk.bloodCost} ì†Œëª¨! HP +${heal} íšŒë³µ!`,'v');

  } else if(sk.type==='summon_zombie'){
    const zHp = 90;
    const zAtk = 5 + player.lv;
    const zId = Date.now();
    zombies.push({id:zId, hp:zHp, maxHp:zHp, atk:zAtk, summonedTurn:true});
    zombieJustSummoned = true;
    addLog(`ğŸ§Ÿ ì¢€ë¹„ ì†Œí™˜! (HP ${zHp} Â· ATK ${zAtk}) â€” ì  ê³µê²©ì„ ëŒ€ì‹  ë§ìŠµë‹ˆë‹¤!`,'p');
    renderZombies();
    const alive=zombies.filter(z=>z.hp>0).length;
    const prevZ=getGlobalStat('maxZombies');
    if(alive>prevZ) setGlobalStat('maxZombies',alive);
    checkAchievements();

  } else if(sk.type==='necro_explode'){
    const aliveZ = zombies.filter(z=>z.hp>0);
    if(aliveZ.length===0){ addLog('ğŸ’¥ ì‹œì²´ í­ë°œ ì‹¤íŒ¨! ì‚´ì•„ìˆëŠ” ì¢€ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤.','e'); sk.cd=0; player.mp+=sk.mp; return; }
    const sacrificed = aliveZ[0];
    sacrificed.hp=0;
    renderZombies();
    const en=getTarget(); if(!en) return;
    const mult = 3.0 + (zombies.filter(z=>z.hp<=0).length * 0.3);
    const dmg = calcDmg(effAtk()*mult, en.def);
    dealDmg(en, dmg);
    addLog(`ğŸ’¥ ì‹œì²´ í­ë°œ! ì¢€ë¹„ 1ê¸° ì†Œëª¨ â†’ ${en.name} ${dmg} ë°ë¯¸ì§€!`,'p');

  } else if(sk.type==='dmg'||sk.type==='multi'){
    const en=getTarget(); if(!en) return;
    const hits=sk.hits||1;
    for(let h=0;h<hits;h++){
      if(en.hp<=0) break;
      const dmg=calcDmg(effAtk()*(sk.mult||1)+(sk.bonus||0), en.def);
      dealDmg(en,dmg);
    }
    const totalDmg=calcPreview(sk,en);
    addLog(`${sk.icon} ${sk.name} â†’ ${en.name} ${totalDmg} ë°ë¯¸ì§€!`,'p');
    if(en.hp>0&&sk.poison){ en.poison={dmg:Math.floor(effAtk()*.35),turns:3}; addLog(`â˜  ë… ë¶€ì—¬!`,'p'); }
    if(sk.selfBuff){ Object.assign(buffs,{defB:(buffs.defB||0)+sk.selfBuff.defB, defTurns:sk.selfBuff.t}); }

  } else if(sk.type==='all'){
    let tot=0;
    enemies.forEach(en=>{
      if(en.hp<=0) return;
      const dmg=calcDmg(effAtk()*(sk.mult||1), en.def);
      dealDmg(en,dmg); tot+=dmg;
    });
    addLog(`${sk.icon} ${sk.name} â†’ ì „ì²´ ê³µê²©! ì´ ${tot} ë°ë¯¸ì§€`,'p');

  } else if(sk.type==='buff'){
    Object.assign(buffs,{...sk.buff, turns:sk.buff.t});
    addLog(`${sk.icon} ${sk.name} â†’ ë²„í”„ ë°œë™!`,'p');

  } else if(sk.type==='heal_mp'){
    const mpHeal=Math.floor((sk.healMp||0) * effMpRegMult());
    player.mp=Math.min(player.maxMp+effMaxMpBonus(),player.mp+mpHeal);
    addLog(`${sk.icon} ${sk.name} â†’ MP +${mpHeal}`,'h');
  }

  updateHud(); renderSkills();
  tryEndPlayerTurn();
}

function tryEndPlayerTurn(){
  if(enemies.every(e=>e.hp<=0)){
    victoryPending=false;
    busy=true; playerTurn=false;
    setTurnBadge(false); setActionBtns(); renderSkills();
    setTimeout(onVictory, 400);
  } else {
    endPlayerTurn();
  }
}

function dealDmg(en, dmg){
  en.hp=Math.max(0,en.hp-dmg);
  showFloat(en.id,dmg,'#e05050');
  renderEnemies();
  if(en.hp<=0) onKill(en);
}

function onKill(en){
  addLog(`ğŸ’¥ ${en.name} ì²˜ì¹˜!`,'s');
  gold+=en.gold;
  gainExp(en.exp);
  incGlobalStat('kills');
  if(enemies.every(e=>e.hp<=0)) victoryPending=true;
}

let victoryPending=false;
let victoryDone=false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì  í„´ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function endPlayerTurn(){
  playerTurn=false; busy=true;
  setTurnBadge(false);
  setActionBtns();
  renderSkills();

  if(buffs.turns!==undefined){ buffs.turns--; if(buffs.turns<=0){ delete buffs.atkB; delete buffs.dodge; delete buffs.turns; } }
  if(buffs.defTurns!==undefined){ buffs.defTurns--; if(buffs.defTurns<=0){ delete buffs.defB; delete buffs.defTurns; } }

  if(victoryPending || enemies.every(e=>e.hp<=0)){
    victoryPending=false;
    setTimeout(onVictory, 400);
    return;
  }

  let zombieDelay=0;
  const aliveZombiesAtk = zombies.filter(z=>z.hp>0);
  zombies.forEach(z=>{ z.summonedThisTurn=false; });
  zombieJustSummoned=false;

  aliveZombiesAtk.forEach(zb=>{
    setTimeout(()=>{
      const aliveEn = enemies.filter(e=>e.hp>0);
      if(aliveEn.length===0) return;
      const target = aliveEn[Math.floor(Math.random()*aliveEn.length)];
      const dmg = Math.max(1, zb.atk + rnd(-1,2));
      dealDmg(target, dmg);
      addLog(`ğŸ§Ÿ ì¢€ë¹„ ê³µê²© â†’ ${target.name} ${dmg} ë°ë¯¸ì§€!`,'p');
      if(enemies.every(e=>e.hp<=0)){ victoryPending=true; }
    }, zombieDelay);
    zombieDelay+=400;
  });

  const alive=enemies.filter(e=>e.hp>0);
  let delay=zombieDelay+200;
  alive.forEach(en=>{
    setTimeout(()=>{
      if(player.hp<=0) return;
      if(en.poison){
        const pdmg=en.poison.dmg;
        en.hp-=pdmg;
        addLog(`â˜  ${en.name} ë… ${pdmg}`,'x');
        showFloat(en.id,pdmg,'#9b59b6');
        renderEnemies();
        if(en.hp<=0){
          addLog(`ğŸ’¥ ${en.name} ë…ìœ¼ë¡œ ì²˜ì¹˜!`,'s'); gold+=en.gold; gainExp(en.exp);
          if(enemies.every(e=>e.hp<=0)){ setTimeout(onVictory,400); return; }
          return;
        }
      }
      if(buffs.dodge&&Math.random()<buffs.dodge){
        addLog(`ğŸ’¨ ${en.name} ê³µê²© íšŒí”¼!`,'p'); return;
      }
      // ì €ê²©ìˆ˜ ê¸°ë³¸ ìœ„ì¥ 10% íšŒí”¼ (ë²„í”„ íšŒí”¼ì™€ ë³„ê°œ)
      if(player.isSniper && !buffs.dodge && Math.random()<(player.baseDodge||0.10)){
        addLog(`ğŸª– ìœ„ì¥! ${en.name}ì˜ ê³µê²©ì„ íšŒí”¼í–ˆë‹¤! (ê¸°ë³¸ 10%)`,'p'); return;
      }
      if(player.isMosquito&&Math.random()<0.99){
        mosquitoStreakCount++;
        const prev=getGlobalStat('mosquitoStreak');
        if(mosquitoStreakCount>prev) setGlobalStat('mosquitoStreak',mosquitoStreakCount);
        checkAchievements();
        addLog(`ğŸ¦Ÿ ëª¨ê¸°ê°€ ì¬ë¹ ë¥´ê²Œ íšŒí”¼í–ˆë‹¤! (ì—°ì† ${mosquitoStreakCount}íšŒ)`,'p');
        return;
      }
      mosquitoStreakCount=0;

      const def=effDef();
      const dmg=Math.max(4, en.atk-def+rnd(-2,3));
      if(player.isGod){
        addLog(`ğŸ‘Š ${en.name} ê³µê²© â†’ ì‹ ì—ê²Œ ë§‰í˜”ë‹¤! (0 ë°ë¯¸ì§€)`,'s');
        return;
      }
      const aliveZombies = zombies.filter(z=>z.hp>0);
      if(aliveZombies.length>0){
        const shield = aliveZombies[0];
        const wasJustSummoned = (shield.summonedTurn===true);
        shield.hp = Math.max(0, shield.hp - dmg);
        if(shield.hp<=0){
          zombieDeadThisRun++;
          incGlobalStat('zombieDead');
          if(wasJustSummoned) incGlobalStat('zombieInstaDead');
          checkAchievements();
        }
        addLog(`ğŸ§Ÿ ì¢€ë¹„ê°€ ${en.name}ì˜ ê³µê²© ${dmg}ì„ ëŒ€ì‹  ë§ì•˜ë‹¤!${shield.hp<=0?' (ì¢€ë¹„ ì‚¬ë§ ğŸª¦)':''}`, 'p');
        const zCard = document.getElementById('z-'+shield.id);
        if(zCard){ zCard.classList.remove('zombie-hit'); void zCard.offsetWidth; zCard.classList.add('zombie-hit'); }
        renderZombies();
        return;
      }
      player.hp=Math.max(0,player.hp-dmg);
      addLog(`ğŸ‘Š ${en.name} â†’ ${dmg} ë°ë¯¸ì§€`,'e');
      onPlayerHit(dmg);
      if(player.isBomber) incGlobalStat('bomberSelfDmg', dmg);

      if(en.name==='ìŠ¬ë¼ì„' && player.hp<=0) incGlobalStat('lostToSlime');

      const pc=document.querySelector('.player-card');
      pc.classList.remove('do-shake'); void pc.offsetWidth; pc.classList.add('do-shake');
      updateHud();
      if(player.hp<=0){ setTimeout(onDefeat,300); }
    },delay);
    delay+=600;
  });

  setTimeout(()=>{
    if(player.hp<=0) return;
    if(victoryPending || enemies.every(e=>e.hp<=0)){
      victoryPending=false;
      onVictory();
      return;
    }
    startPlayerTurn();
  },delay+200);
}

function startPlayerTurn(){
  playerTurn=true; busy=false; defending=false;
  player.skills.forEach(s=>{if(s.cd>0)s.cd--;});
  enemies.forEach(en=>{
    if(en.hp<=0||!en.poison) return;
    en.poison.turns--;
    if(en.poison.turns<=0) en.poison=null;
  });
  setTurnBadge(true);
  renderAll();
  addLog('â”€â”€ ë‚´ í„´','s');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ìŠ¹íŒ¨ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onVictory(){
  if(victoryDone) return;
  victoryDone=true;
  busy=true; playerTurn=false;
  addLog(`ğŸ‰ STAGE ${stage+1} í´ë¦¬ì–´!`,'s');
  const isFinalClear = selectedMode!=='infinite' && stage===FINAL_STAGE;
  saveRecord(isFinalClear);
  if(selectedMode==='infinite'){
    addLog(`â™¾ï¸ ìµœê³  ê¸°ë¡: ${stage+1} ìŠ¤í…Œì´ì§€`,'s');
    setTimeout(showShop, 500);
  } else if(stage===FINAL_STAGE){
    setTimeout(showEnding, 600);
  } else {
    setTimeout(showShop, 500);
  }
}

function showEnding(){
  const firstClear = !hardMode;
  hardMode = true;
  localStorage.setItem('db_hardMode', 'true');
  const bloodInfo=player.isVampire ? `<div class="r-row"><span>ğŸ©¸ ìµœì¢… í˜ˆê¸°</span><span class="r-val">${player.blood}/${player.maxBlood}</span></div>` : '';
  document.getElementById('ending-card').innerHTML=`
    <div class="r-row"><span>ğŸ§™ ì§ì—…</span><span class="r-val">${player.icon} ${player.name}</span></div>
    <div class="r-row"><span>â­ ìµœì¢… ë ˆë²¨</span><span class="r-val">Lv ${player.lv}</span></div>
    <div class="r-row"><span>âš” ìµœì¢… ATK</span><span class="r-val">${effAtk()}</span></div>
    <div class="r-row"><span>ğŸ›¡ ìµœì¢… DEF</span><span class="r-val">${effDef()}</span></div>
    <div class="r-row"><span>â¤ ë‚¨ì€ HP</span><span class="r-val">${player.hp}/${player.maxHp}</span></div>
    ${bloodInfo}
    <div class="r-row"><span>ğŸ’° ì´ ê³¨ë“œ</span><span class="r-val">${gold}G</span></div>
  `;
  document.getElementById('hardmode-unlock-notice').style.display = firstClear ? 'block' : 'none';
  showScreen('ending');
}

function onDefeat(){
  busy=true; playerTurn=false;
  saveRecord(false);
  const isInfinite = selectedMode==='infinite';
  document.getElementById('r-msg').textContent= isInfinite
    ? `â™¾ï¸ ë¬´í•œ ëª¨ë“œ â€” STAGE ${stage+1}ì—ì„œ ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤!`
    : `STAGE ${stage+1}ì—ì„œ ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤...`;
  document.getElementById('r-card').innerHTML=`
    <div class="r-row"><span>ğŸ® ëª¨ë“œ</span><span class="r-val">${isInfinite?'â™¾ï¸ ë¬´í•œ':selectedMode==='hard'?'ğŸ”¥ í•˜ë“œ':'âš”ï¸ ì¼ë°˜'}</span></div>
    <div class="r-row"><span>${isInfinite?'ğŸ† ìµœê³  ìŠ¤í…Œì´ì§€':'ë„ë‹¬ ìŠ¤í…Œì´ì§€'}</span><span class="r-val">STAGE ${stage+1}</span></div>
    <div class="r-row"><span>ìµœì¢… ë ˆë²¨</span><span class="r-val">Lv ${player.lv}</span></div>
    <div class="r-row"><span>ì´ ê³¨ë“œ</span><span class="r-val">${gold}G</span></div>
  `;
  showScreen('result');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ìƒì  â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showShop(){
  document.getElementById('shop-gold').textContent=gold;
  document.getElementById('shop-hpot').textContent=hpPots;
  document.getElementById('shop-mpot').textContent=mpPots;
  document.getElementById('shop-btn-hp').disabled=gold<20;
  document.getElementById('shop-btn-mp').disabled=gold<15;
  document.getElementById('shop-player-bar').innerHTML=`
    <span style="font-size:20px">${player.icon}</span>&nbsp;
    <strong>${player.name}</strong> Lv${player.lv} &nbsp;|&nbsp;
    â¤ ${player.hp}/${player.maxHp} &nbsp;
    âš” ATK ${effAtk()} &nbsp;
    ğŸ›¡ DEF ${effDef()}
    ${player.isVampire ? `&nbsp; ğŸ©¸ í˜ˆê¸° ${player.blood}/${player.maxBlood}` : `&nbsp;ğŸ’œ MP ${player.mp}/${player.maxMp}`}
  `;
  const total=hpPots+mpPots;
  const prevMax=getGlobalStat('maxPotionOwned');
  if(total>prevMax) setGlobalStat('maxPotionOwned',total);
  renderShopGrid();
  showScreen('shop');
}

function renderShopGrid(){
  const g=document.getElementById('shop-grid');
  g.innerHTML='';
  ITEMS.forEach(item=>{
    const isOwned=owned.includes(item.id);
    const isEq=Object.values(equipped).some(e=>e&&e.id===item.id);
    const canAff=gold>=item.cost;
    const d=document.createElement('div');
    d.className='shop-item'+(isEq?' is-equipped':!canAff&&!isOwned?' no-gold':'');
    const stats=[
      item.atk?`âš”+${item.atk}`:'',
      item.def?`ğŸ›¡+${item.def}`:'',
      item.mpReg?`ğŸ’§íšŒë³µ+${Math.round(item.mpReg*100)}%`:'',
      item.mpMax?`ğŸ’œìµœëŒ€MP+${item.mpMax}`:'',
    ].filter(Boolean).join('  ');
    d.innerHTML=`
      <div class="si-head">
        <div class="si-icon">${item.icon}</div>
        <div><div class="si-name">${item.name}</div><div class="si-slot">${SLOT_LABEL[item.slot]}</div></div>
      </div>
      <div class="si-stat">${stats}</div>
      <div class="si-foot">
        ${isEq
          ? '<span style="color:var(--green);font-size:11px;font-weight:700">âœ… ì¥ì°©ì¤‘</span>'
          : isOwned
            ? `<span style="color:var(--green);font-size:11px">ë³´ìœ </span>
               <button class="btn btn-blue" style="font-size:11px;padding:4px 10px" onclick="shopEquip('${item.id}')">ì¥ì°©</button>`
            : canAff
              ? `<span class="si-price">${item.cost}G</span>
                 <button class="btn btn-gold" style="font-size:11px;padding:4px 10px" onclick="shopBuy('${item.id}')">êµ¬ë§¤</button>`
              : `<span style="color:#444;font-size:11px">${item.cost}G</span>
                 <span style="font-size:10px;color:#444">ë¶€ì¡±</span>`
        }
      </div>
    `;
    g.appendChild(d);
  });
}

function shopBuy(id){
  const item=ITEMS.find(i=>i.id===id);
  if(!item||gold<item.cost) return;
  gold-=item.cost;
  owned.push(item.id);
  equipped[item.slot]=item;
  document.getElementById('shop-gold').textContent=gold;
  document.getElementById('shop-btn-hp').disabled=gold<20;
  document.getElementById('shop-btn-mp').disabled=gold<15;
  document.getElementById('shop-player-bar').innerHTML=`
    <span style="font-size:20px">${player.icon}</span>&nbsp;
    <strong>${player.name}</strong> Lv${player.lv} &nbsp;|&nbsp;
    â¤ ${player.hp}/${player.maxHp} &nbsp;
    âš” ATK ${effAtk()} &nbsp;
    ğŸ›¡ DEF ${effDef()}
    ${player.isVampire ? `&nbsp; ğŸ©¸ ${player.blood}/${player.maxBlood}` : `&nbsp;ğŸ’œ MP ${player.mp}/${player.maxMp}`}
  `;
  renderShopGrid();
}
function shopEquip(id){
  const item=ITEMS.find(i=>i.id===id);
  if(!item) return;
  equipped[item.slot]=item;
  renderShopGrid();
}
function shopBuyHp(){
  if(gold<20) return;
  gold-=20; hpPots++;
  const total=hpPots+mpPots;
  const prevMax=getGlobalStat('maxPotionOwned');
  if(total>prevMax) setGlobalStat('maxPotionOwned',total);
  document.getElementById('shop-gold').textContent=gold;
  document.getElementById('shop-hpot').textContent=hpPots;
  document.getElementById('shop-btn-hp').disabled=gold<20;
  document.getElementById('shop-btn-mp').disabled=gold<15;
  checkAchievements();
}
function shopBuyMp(){
  if(gold<15) return;
  gold-=15; mpPots++;
  const total=hpPots+mpPots;
  const prevMax=getGlobalStat('maxPotionOwned');
  if(total>prevMax) setGlobalStat('maxPotionOwned',total);
  document.getElementById('shop-gold').textContent=gold;
  document.getElementById('shop-mpot').textContent=mpPots;
  document.getElementById('shop-btn-hp').disabled=gold<20;
  document.getElementById('shop-btn-mp').disabled=gold<15;
  checkAchievements();
}
function shopNext(){
  stage++;
  showScreen('battle');
  loadStage();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ê²½í—˜ì¹˜ & ë ˆë²¨ì—… â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gainExp(exp){
  player.exp+=exp;
  while(player.exp>=player.expNext){
    player.exp-=player.expNext;
    player.lv++;
    player.expNext=Math.floor(player.expNext*1.4);
    const h=player.hpG,a=player.atkG,d=player.defG,m=player.mpG;
    if(!player.isMosquito){ player.maxHp+=h; player.hp=Math.min(player.maxHp,player.hp+Math.floor(h/2)); }
    player.maxMp+=m; player.mp=Math.min(player.maxMp,player.mp+Math.floor(m/2));
    player.atk+=a; player.def+=d;
    if(player.isVampire) player.maxBlood+=10;
    if(player.isBomber){ player.maxFuse=Math.min(200, player.maxFuse+5); }
    luQueue.push({lv:player.lv,h,a,d,m});
    addLog(`â¬† LEVEL UP! Lv ${player.lv}`,'s');
  }
  updateHud();
  if(luQueue.length) showLu();
}
function showLu(){
  if(!luQueue.length) return;
  const lu=luQueue.shift();
  document.getElementById('lu-lv').textContent=lu.lv;
  document.getElementById('lu-stats').innerHTML=`â¤ HP+${lu.h}&nbsp;&nbsp;âš” ATK+${lu.a}<br>ğŸ›¡ DEF+${lu.d}&nbsp;&nbsp;ğŸ’œ MP+${lu.m}${player.isVampire?'<br>ğŸ©¸ ìµœëŒ€í˜ˆê¸°+10':''}`;
  document.getElementById('lu-overlay').style.display='flex';
}
function closeLu(){
  document.getElementById('lu-overlay').style.display='none';
  if(luQueue.length) setTimeout(showLu,200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ìœ í‹¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function effAtk(){ const base=player.atk+(buffs.atkB||0)+(equipped.weapon?.atk||0)+(equipped.ring?.atk||0)+(equipped.amulet?.atk||0); return (hardMode&&selectedMode==='hard')?Math.floor(base*1.15):base; }
function effDef(){ if(player.isMosquito) return 0; const base=player.def+(buffs.defB||0)+(equipped.armor?.def||0)+(equipped.ring?.def||0)+(equipped.amulet?.def||0); return (hardMode&&selectedMode==='hard')?Math.floor(base*1.15):base; }
function effMpRegMult(){ return 1+(equipped.mpreg?.mpReg||0); }
function effMaxMpBonus(){ return equipped.mpmax?.mpMax||0; }
function calcDmg(base,def){ return Math.max(1,Math.floor(base-Math.max(0,def-2)+rnd(-3,4))); }
function rnd(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function canAct(){ return playerTurn&&!busy; }
function getTarget(){
  if(enemies[targetIdx]?.hp>0) return enemies[targetIdx];
  const i=enemies.findIndex(e=>e.hp>0);
  if(i>=0){ targetIdx=i; return enemies[i]; }
  return null;
}

function calcPreview(sk, en){
  if(!en||en.hp<=0) return '?';
  const atk=effAtk();
  if(sk.type==='dmg') return calcDmg(atk*(sk.mult||1)+(sk.bonus||0), en.def);
  if(sk.type==='multi') return `${calcDmg(atk*(sk.mult||1),en.def)}Ã—${sk.hits||2}`;
  if(sk.type==='drain'){
    const dmg=calcDmg(atk*(sk.mult||1), en.def);
    return `DMG:${dmg} / í¡:${Math.floor(dmg*(sk.drainRatio||0.6))}`;
  }
  if(sk.type==='drain_all'){
    const alive=enemies.filter(e=>e.hp>0);
    return `ì „ì²´ ${alive.length}ë§ˆë¦¬`;
  }
  if(sk.type==='all'){
    const alive=enemies.filter(e=>e.hp>0);
    return alive.map(e=>calcDmg(atk*(sk.mult||1),e.def)).join('+');
  }
  if(sk.type==='blood_heal'){
    return `HP+${Math.floor(player.maxHp*(sk.healRatio||0.35))}`;
  }
  if(sk.type==='sniper_shot'){
    const dmg = calcDmg(effAtk()*(sk.mult||1), en.def);
    const hs = Math.floor(dmg*2);
    const aimStr = sniperAimReady ? 'ğŸ”ì¡°ì¤€ì¤‘â†’' : '30%â†’';
    return `${dmg} (${aimStr}í—¤ë“œìƒ· ${hs})`;
  }
  if(sk.type==='sniper_drink') return `HP+${Math.floor(player.maxHp*(sk.healRatio||0.30))}`;
  if(sk.type==='howitzer'){ const dmg=calcDmg(effAtk()*(sk.mult||6.0),en.def); return `í¬ê²© DMG:${dmg}`; }
  if(sk.type==='bomb_all'||sk.type==='bomb_smoke'){
    const alive=enemies.filter(e=>e.hp>0);
    const perEn=alive.map(e=>calcDmg(atk*(sk.mult||1),e.def));
    return `ì „ì²´: ${perEn.join('+')}`;
  }
  if(sk.type==='bomb_chain'){
    const alive=enemies.filter(e=>e.hp>0);
    const perEn=alive.map(e=>calcDmg(atk*(sk.mult||1),e.def)*2);
    return `Ã—2ì—°ì†: ${perEn.join('+')}`;
  }
  return '-';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â• ë Œë”ë§ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAll(){
  renderEnemies();
  renderZombies();
  renderSkills();
  updateHud();
  setActionBtns();
}

function renderZombies(){
  if(!player||!player.isNecro) return;
  const z=document.getElementById('zombie-zone');
  if(!z) return;
  z.innerHTML='';

  const aliveCount = zombies.filter(zb=>zb.hp>0).length;
  const deadCount  = zombies.filter(zb=>zb.hp<=0).length;

  const badge = document.getElementById('zombie-count-badge');
  if(badge){
    badge.textContent = `ğŸŸ¢ ${aliveCount}ë§ˆë¦¬ ìƒì¡´`;
    badge.style.display = zombies.length>0 ? 'inline-flex' : 'none';
    if(deadCount>0){
      badge.textContent += `  ğŸª¦ ${deadCount}ë§ˆë¦¬ ì‚¬ë§`;
    }
  }

  zombies.filter(zb=>zb.hp>0).forEach(zb=>{
    const d=document.createElement('div');
    d.className='zombie-card';
    d.id='z-'+zb.id;
    d.innerHTML=`
      <div class="z-icon">ğŸ§Ÿ</div>
      <div class="z-name">ì¢€ë¹„</div>
      <div class="z-hpbar"><div class="z-hpfill" style="width:${Math.max(0,zb.hp/zb.maxHp*100)}%"></div></div>
      <div class="z-hp">${Math.max(0,zb.hp)}/${zb.maxHp}</div>
    `;
    z.appendChild(d);
  });

  zombies.filter(zb=>zb.hp<=0).forEach(zb=>{
    const d=document.createElement('div');
    d.className='zombie-card zombie-dead';
    d.id='z-'+zb.id;
    d.title='ì „ì‚¬í•œ ì¢€ë¹„';
    d.innerHTML=`<span class="z-gravestone">ğŸª¦</span>`;
    z.appendChild(d);
  });
}

function renderEnemies(){
  const z=document.getElementById('enemy-zone');
  z.innerHTML='';
  enemies.forEach((en,i)=>{
    const d=document.createElement('div');
    d.className='enemy-card'+(en.hp<=0?' dead':i===targetIdx?' targeted':'');
    d.id='en-'+i;
    d.innerHTML=`
      <div class="e-icon">${en.icon}</div>
      <div class="e-name">${en.name}</div>
      <div class="e-hpbar"><div class="e-hpfill" style="width:${Math.max(0,en.hp/en.maxHp*100)}%"></div></div>
      <div class="e-hp">${Math.max(0,en.hp)}/${en.maxHp}</div>
      ${en.poison?'<div class="e-status">â˜ ë…</div>':''}
      <div class="e-status" style="color:var(--muted)">ATK${en.atk} DEF${en.def}</div>
    `;
    d.onclick=()=>{ if(en.hp>0){ targetIdx=i; renderEnemies(); renderSkills(); updateHud(); } };
    z.appendChild(d);
  });
}

function renderSkills(){
  const g=document.getElementById('skills-grid');
  g.innerHTML='';
  const en=getTarget();
  player.skills.forEach((sk,i)=>{
    const onCd=sk.cd>0;
    const noMp=player.mp<sk.mp;
    const noBlood=sk.bloodCost&&player.blood<sk.bloodCost;
    const ok=canAct()&&!onCd&&!noMp&&!noBlood;
    const preview=calcPreview(sk,en);
    const isVampSkill=['drain','drain_all','blood_burst','blood_heal'].includes(sk.type);
    const isMkSkill=player.isMegaKnight;
    const isBombSkill=['bomb_all','bomb_smoke','bomb_chain'].includes(sk.type);
    const isSniperSkill=['sniper_shot','sniper_drink','howitzer'].includes(sk.type);
    const bloodReady=isVampSkill&&ok&&sk.bloodCost&&player.blood>=sk.bloodCost;
    const fuseReady=isBombSkill&&ok&&sk.fuseCost&&player.fuse>=sk.fuseCost;
    const noFuse=sk.fuseCost&&player.fuse<sk.fuseCost;
    const aimReady=isSniperSkill&&ok&&sk.type==='sniper_shot'&&sniperAimReady;

    const btn=document.createElement('button');
    btn.className='skill-btn'
      +(isVampSkill?' vampire-skill':isMkSkill?' mk-skill':isBombSkill?' bomb-skill':isSniperSkill?' sniper-skill':'')
      +(bloodReady?' blood-skill-available':fuseReady?' bomb-skill-ready':aimReady?' sniper-skill-ready':isMkSkill&&ok?' mk-skill-active':'');
    btn.disabled=!ok||!!noFuse;
    const mpDisplay = player.isMegaKnight ? 'ë¬´ì†Œëª¨' : `MP${sk.mp}`;
    const fuseInfo = sk.fuseCost ? ` Â· ğŸ§¨${sk.fuseCost}` : sk.fuseGain ? ` Â· +ğŸ§¨${sk.fuseGain}` : '';
    btn.innerHTML=`
      <div class="sk-icon">${sk.icon}</div>
      <div class="sk-info">
        <div class="sk-name">${sk.name}</div>
        <div class="sk-meta">${sk.desc} Â· ${mpDisplay}${sk.bloodCost?` Â· ğŸ©¸${sk.bloodCost}`:''}${fuseInfo}</div>
        ${onCd?`<div class="sk-cd">ì¿¨ë‹¤ìš´ ${sk.cd}í„´</div>`:
          noMp?`<div class="sk-cd">MP ë¶€ì¡±</div>`:
          noBlood?`<div class="sk-cd">ğŸ©¸ í˜ˆê¸° ë¶€ì¡± (${player.blood||0}/${sk.bloodCost})</div>`:
          noFuse?`<div class="sk-cd">ğŸ§¨ ë„í™”ì„  ë¶€ì¡± (${player.fuse||0}/${sk.fuseCost})</div>`:
          `<div class="sk-preview${isVampSkill?' blood-preview':isBombSkill?' bomb-preview':isSniperSkill?' sniper-preview':''}">${preview}</div>`}
      </div>
    `;
    btn.onclick=()=>useSkill(i);
    g.appendChild(btn);
  });
}

function updateHud(){
  const p=player;
  document.getElementById('p-avatar').textContent=p.icon;
  document.getElementById('p-name').textContent=p.name;
  document.getElementById('p-lv').textContent=p.lv;
  document.getElementById('hud-lv').textContent=p.lv;
  document.getElementById('p-hp').textContent=player.isGod?'âˆ':Math.max(0,p.hp);
  document.getElementById('p-mhp').textContent=player.isGod?'âˆ':p.maxHp;
  document.getElementById('p-mp').textContent=player.isGod?'âˆ':p.mp;
  const totalMaxMp=p.maxMp+effMaxMpBonus();
  document.getElementById('p-mmp').textContent=player.isGod?'âˆ':totalMaxMp;
  document.getElementById('mp-bar-wrap').style.display=p.isMegaKnight?'none':'flex';
  document.getElementById('p-atk').textContent=player.isGod?'âˆ':effAtk();
  document.getElementById('p-def').textContent=player.isGod?'âˆ':effDef();
  document.getElementById('bar-hp').style.width=(player.isGod?100:Math.max(0,p.hp/p.maxHp*100))+'%';
  document.getElementById('bar-mp').style.width=(player.isGod?100:Math.min(100,p.mp/totalMaxMp*100))+'%';
  document.getElementById('bar-exp').style.width=p.exp/p.expNext*100+'%';
  document.getElementById('exp-val').textContent=p.exp+'/'+p.expNext;

  if(p.isVampire){
    document.getElementById('p-blood').textContent=p.blood;
    document.getElementById('p-mblood').textContent=p.maxBlood;
    document.getElementById('bar-blood').style.width=(p.blood/p.maxBlood*100)+'%';
    const bt=document.getElementById('blood-track');
    if(p.blood>=50) bt.classList.add('blood-ready');
    else bt.classList.remove('blood-ready');
  }

  if(p.isBomber){
    document.getElementById('p-fuse').textContent=p.fuse;
    document.getElementById('p-mfuse').textContent=p.maxFuse;
    document.getElementById('bar-fuse').style.width=(p.fuse/p.maxFuse*100)+'%';
    const ft=document.getElementById('fuse-track');
    if(p.fuse>=70) ft.classList.add('fuse-ready');
    else ft.classList.remove('fuse-ready');
  }

  const en=getTarget();
  const basicBtn=document.getElementById('btn-basic');
  if(p.isBomber){
    basicBtn.innerHTML='ğŸ’£ íˆ¬ì²™ê³µê²©<br><span id="basic-preview" style="font-size:10px;color:#ff8c00">ì „ì²´ DMG: -</span>';
  } else if(!basicBtn.querySelector('#basic-preview')){
    basicBtn.innerHTML='âš” ê¸°ë³¸ê³µê²©<br><span id="basic-preview" style="font-size:10px;color:var(--blue)">DMG: -</span>';
  }
  if(en&&en.hp>0){
    const base=Math.floor(effAtk()*.8);
    const def=Math.max(0,en.def-2);
    const mn=Math.max(1,base-def-3), mx=Math.max(1,base-def+4);
    const mpReg=Math.max(1,Math.floor(p.maxMp*.06 * effMpRegMult()));
    if(p.isBomber){
      const allPrev=enemies.filter(e=>e.hp>0).map(e=>calcDmg(base,Math.max(0,e.def-2))).join('+');
      const bpEl=document.getElementById('basic-preview');
      if(bpEl) bpEl.textContent=`ì „ì²´: ${allPrev}`;
    } else if(p.isVampire){
      const bg=Math.max(3,Math.floor(((mn+mx)/2)*0.2));
      const bpEl=document.getElementById('basic-preview');
      if(bpEl) bpEl.textContent=`DMG: ${mn}~${mx} / ğŸ©¸+${bg}`;
    } else {
      const bpEl=document.getElementById('basic-preview');
      if(bpEl) bpEl.textContent=`DMG: ${mn}~${mx} / MP+${mpReg}`;
    }
  } else {
    const bpEl=document.getElementById('basic-preview');
    if(bpEl) bpEl.textContent=p.isBomber?'ì „ì²´ DMG: -':'DMG: -';
  }
}

function setActionBtns(){
  const ok=canAct();
  document.getElementById('btn-basic').disabled=!ok;
  document.getElementById('btn-defend').disabled=!ok;
  document.getElementById('btn-hp-pot').disabled=!ok||hpPots<=0;
  document.getElementById('btn-mp-pot').disabled=!ok||mpPots<=0||player.isMegaKnight;
  document.getElementById('btn-mp-pot').style.display=player.isMegaKnight?'none':'block';
  document.getElementById('hpot-cnt').textContent=hpPots+'ê°œ';
  document.getElementById('mpot-cnt').textContent=mpPots+'ê°œ';
}

function setTurnBadge(myTurn){
  const b=document.getElementById('turn-badge');
  b.textContent=myTurn?'ë‚´ í„´':'ì  í„´';
  b.className='turn-badge'+(myTurn?'':' enemy-turn');
}

function addLog(msg,type=''){
  const b=document.getElementById('log-box');
  const el=document.createElement('div');
  el.className='log-'+type;
  el.textContent=msg;
  b.appendChild(el);
  b.scrollTop=b.scrollHeight;
  while(b.children.length>50) b.removeChild(b.firstChild);
}
function clearLog(){ document.getElementById('log-box').innerHTML=''; }

function showFloat(id,dmg,color){
  const card=document.getElementById('en-'+id);
  if(!card) return;
  const el=document.createElement('div');
  el.className='float-dmg'; el.style.color=color;
  el.textContent='-'+dmg;
  card.appendChild(el);
  setTimeout(()=>el.remove(),850);
}

function showScreen(name){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen-'+name).classList.add('active');
}

function goTitle(){
  showScreen('title');
  applyVampireTheme(false);
  updateModeUI();
}

function selectMode(mode){
  if(mode==='hard' && !hardMode) return;
  selectedMode=mode;
  updateModeUI();
}

function updateModeUI(){
  const normalCard=document.getElementById('mode-normal');
  const hardCard=document.getElementById('mode-hard');
  const infiniteCard=document.getElementById('mode-infinite');
  if(!normalCard||!hardCard||!infiniteCard) return;

  if(hardMode){
    hardCard.classList.remove('locked');
    document.getElementById('hard-desc').textContent='ATKÂ·DEF +15% ê°•í™”ëœ ìŠ¤íƒ¯ìœ¼ë¡œ ë„ì „!';
  } else {
    hardCard.classList.add('locked');
    document.getElementById('hard-desc').textContent='20ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ í›„ í•´ì œë©ë‹ˆë‹¤';
  }

  normalCard.className='mode-card'+(selectedMode==='normal'?' sel-normal':'');
  hardCard.className='mode-card'+(hardMode?(selectedMode==='hard'?' sel-hard':''):'locked');
  infiniteCard.className='mode-card'+(selectedMode==='infinite'?' sel-infinite':'');
}

function switchTutTab(idx){
  document.querySelectorAll('.tut-tab').forEach((t,i)=>t.classList.toggle('active',i===idx));
  document.querySelectorAll('.tut-page').forEach((p,i)=>p.classList.toggle('active',i===idx));
}
</script>
</body>
</html>
